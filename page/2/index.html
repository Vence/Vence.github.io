<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>王文路的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="王文路的博客">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="王文路的博客">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="王文路的博客">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="王文路的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://i2.piimg.com/62a5ce5907610d14.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">王文路</a></h1>
		</hgroup>

		
		<p class="header-subtitle">自弃者扶不起，自强者击不倒</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						
						<li>Über</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
							<li><a href="/about">关于</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="http://github.com/Vence" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/my0love" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="#" title="rss">rss</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/aop/" style="font-size: 10px;">aop</a> <a href="/tags/backbone/" style="font-size: 12.5px;">backbone</a> <a href="/tags/blog/" style="font-size: 12.5px;">blog</a> <a href="/tags/cluster/" style="font-size: 12.5px;">cluster</a> <a href="/tags/file/" style="font-size: 12.5px;">file</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/hibernate/" style="font-size: 10px;">hibernate</a> <a href="/tags/html/" style="font-size: 10px;">html</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/mail/" style="font-size: 10px;">mail</a> <a href="/tags/mybatis/" style="font-size: 12.5px;">mybatis</a> <a href="/tags/myeclipse/" style="font-size: 10px;">myeclipse</a> <a href="/tags/octopress/" style="font-size: 10px;">octopress</a> <a href="/tags/patent/" style="font-size: 20px;">patent</a> <a href="/tags/permission/" style="font-size: 10px;">permission</a> <a href="/tags/recource/" style="font-size: 10px;">recource</a> <a href="/tags/requirejs/" style="font-size: 10px;">requirejs</a> <a href="/tags/spring/" style="font-size: 17.5px;">spring</a> <a href="/tags/tomcat/" style="font-size: 10px;">tomcat</a> <a href="/tags/web/" style="font-size: 17.5px;">web</a> <a href="/tags/webservice/" style="font-size: 10px;">webservice</a> <a href="/tags/压力测试/" style="font-size: 12.5px;">压力测试</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">生命就像那空中白色的羽毛，或迎风搏击，或随风飘荡，或翱翔蓝天，或坠入深渊...</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">王文路</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="http://i2.piimg.com/62a5ce5907610d14.jpg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">王文路</h1>
			</hgroup>
			
			<p class="header-subtitle">自弃者扶不起，自强者击不倒</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/about">关于</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="http://github.com/Vence" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/my0love" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="#" title="rss">rss</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-web-permission-ctrip" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/06/02/web-permission-ctrip/" class="article-date">
  	<time datetime="2015-06-02T13:26:59.000Z" itemprop="datePublished">2015-06-02</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/02/web-permission-ctrip/">网站账户访问权限的设置系统及方法</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>本文所涉及到的专利是由 <strong>携程计算机技术（上海）有限公司</strong> 于 <strong>2014.07.02</strong> 申请。</p>
<h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p>本系统公开了一种网站账户访问权限的设置系统及方法，方法包括 ：</p>
<p>S1、为每个网站账户设置唯一的身份标识码 ；</p>
<p>S2、为每个网站账户绑定两个以上的访问权限，每个访问权限均列有网站账户的唯一的身份标识码、访问方式以及访问窗口之间的对应关系 ；</p>
<p>S3、为每个访问权限设置对应的网站服务的范围 ；</p>
<p>S4、在接收到由网站账户发出的访问请求后，从所述访问请求中查询出网站账户的身份标识码、访问方式以及访问窗口，并确定网站账户的访问权限 ；</p>
<p>S5、根据确定出的访问权限为网站账户提供对应的网站服务。</p>
<p>本系统采用访问方式及访问窗口等参数为同一个网站账户的不同身份设置不同的访问权限，方便了网站对用户多个身份的统一管理。</p>
<p><img src="http://i1.piimg.com/963b171b2346478c.png" alt=""></p>
<ol>
<li><p>一种网站账户访问权限的设置方法，其特征在于，包括以下步骤 ：</p>
<ul>
<li>S1、为每个网站账户设置一唯一的身份标识码 ；</li>
<li>S2、为每个网站账户绑定两个以上的访问权限，每个访问权限均列有所述网站账户的唯一的身份标识码、访问方式以及访问窗口之间的对应关系 ；</li>
<li>S3、为每个访问权限设置一对应的网站服务的范围 ；</li>
<li>S4、在接收到由一网站账户发出的访问请求后，从所述访问请求中查询出网站账户的身份标识码、访问方式以及访问窗口，并确定网站账户的访问权限 ；</li>
<li>S5、根据步骤 S4 中确定出的访问权限为网站账户提供对应的网站服务。</li>
</ul>
</li>
</ol>
<ol>
<li>如 1 所述的设置方法，其特征在于，所述身份标识码为用户注册所述网站账户时输入的身份证号码、手机号码或邮箱地址。</li>
</ol>
<ol>
<li>如 1 所述的设置方法，其特征在于，所述访问权限包括散客访问权限及商旅访问权限。</li>
</ol>
<ol>
<li>如 3 所述的设置方法，其特征在于，所述访问方式包括电话访问及网络访问，当所述访问方式为电话访问时，所述访问窗口包括散客电话窗口及商旅电话窗口，当所述访问方式为网络访问时，所述访问窗口包括散客登录页面及商旅登录页面。</li>
</ol>
<ol>
<li>如 1 所述的设置方法，其特征在于，步骤 S3 中还为不同的访问权限设置不同的级别，并为级别更高的访问权限设置更大的网站服务的范围。</li>
</ol>
<ol>
<li><p>一种网站账户访问权限的设置系统，其特征在于，包括 ：</p>
<ul>
<li>网站账户设置模块，用于为每个网站账户设置一唯一的身份标识码 ；</li>
<li>绑定模块，用于为每个网站账户绑定两个以上的访问权限，每个访问权限均列有所述网站账户的唯一的身份标识码、访问方式 网站服务设置模块，用于为每个访问权限设置一对应的网站服务的范围 ；</li>
<li>查询模块，用于在接收到由一网站账户发出的访问请求后，从所述访问请求中查询出网站账户的身份标识码、访问方式以及访问窗口，并确定网站账户的访问权限 ；</li>
<li>网站服务提供模块，用于根据确定出的访问权限为网站账户提供对应的网站服务。</li>
</ul>
</li>
<li><p>如 6 所述的设置系统，其特征在于，所述身份标识码为用户注册所述网站账户时输入的身份证号码、手机号码或邮箱地址。</p>
</li>
</ol>
<ol>
<li>如 6 所述的设置系统，其特征在于，所述访问权限包括散客访问权限及商旅访问权限。</li>
</ol>
<ol>
<li>如 8 所述的设置系统，其特征在于，所述访问方式包括电话访问及网络访问，当所述访问方式为电话访问时，所述访问窗口包括散客电话窗口及商旅电话窗口，当所述访问方式为网络访问时，所述访问窗口包括散客登录页面及商旅登录页面。</li>
</ol>
<ol>
<li>如 6 所述的设置系统，其特征在于，所述网站服务设置模块还为不同的访问权限设置不同的级别，并为级别更高的访问权限设置更大的网站服务的范围。</li>
</ol>
<h2 id="技术领域"><a href="#技术领域" class="headerlink" title="技术领域"></a>技术领域</h2><p>本系统涉及一种网站账户访问权限的设置系统及方法，特别是涉及一种适用于用户的网站账户有多种身份且不同的身份对应不同的访问权限的网站账户访问权限的设置系统以及一种利用所述设置系统实现的网站账户访问权限的设置方法。</p>
<h2 id="背景技术"><a href="#背景技术" class="headerlink" title="背景技术"></a>背景技术</h2><p>现在的在线购物网站为了用户的使用方便以及更好地服务用户，都提供了注册网站账户的功能，用户可以通过在购物网站上注册网站账户从而成为网站会员，并且在注册时输入一些相应的用户信息，这样，购物网站就能够将用户信息与网站账户进行绑定，从而<br>有针对性地为用户提供购物服务。但是，对于有些在线购物网站来说，能够让同一个用户针对不同的服务界面注册多个身份，导致同一个用户的不同身份之间有不同的权限以及不同的功能，这导致用户的身份账户体系结构复杂，且账户体系之间相互交错容易造成各种异常问题。</p>
<p>现有的身份识别技术，往往需要对用户的网站帐户进行多种权限的定义，涉及到一整套的规则和权限识别的逻辑以及安全控制。比如要设定帐户 A 是否可以使用功能 B，则需要额外增加一个标示帐户 A 权限的标识，同时在功能 B 的对应区域模块增加一个标识的识别，涉及到多方面的修改，非常复杂也非常繁琐，导致很容易出错。</p>
<h2 id="主要内容"><a href="#主要内容" class="headerlink" title="主要内容"></a>主要内容</h2><p>本系统要解决的技术问题是为了克服现有技术中在线购物网站的身份账户体系结构复杂、相互交错容易造成各种异常问题的缺陷，提供一种适用于用户的网站账户有多种身份且不同的身份对应不同的访问权限的网站账户访问权限的设置系统以及一种利用所述设置系统实现的网站账户访问权限的设置方法。</p>
<p></p><p></p>
<div style="background:#4A4A4A;border-radius:8px;color:white;font-size:1.2em;">通过下述技术方案来解决上述技术问题</div>

<p><strong>本系统提供了一种网站账户访问权限的设置<font color="red">方法</font></strong>，其特点在于，包括以下步骤 ：</p>
<ul>
<li>S1、为每个网站账户设置一唯一的身份标识码 ；</li>
<li>S2、为每个网站账户绑定两个以上的访问权限，每个访问权限均列有所述网站账户的唯一的身份标识码、访问方式以及访问窗口之间的对应关系 ；</li>
<li>S3、为每个访问权限设置一对应的网站服务的范围 ；</li>
<li>S4、在接收到由一网站账户发出的访问请求后，从所述访问请求中查询出网站账户的身份标识码、访问方式以及访问窗口，并确定网站账户的访问权限 ；</li>
<li>S5、根据步骤 S4 中确定出的访问权限为网站账户提供对应的网站服务。</li>
</ul>
<p>对于同一个网站账户来说，会因为访问方式及访问窗口的不同而获得不同的访问权限，进而对应的会获得不同范围的网站服务。</p>
<p>较佳地，所述身份标识码为用户注册所述网站账户时输入的身份证号码、手机号码或邮箱地址。作为标识用户的网站账户的唯一标示，对于不同可信任级别的标示，可以对应地设置不同级别的网站服务的范围。</p>
<p>较佳地，所述访问权限包括散客访问权限及商旅访问权限。</p>
<p>较佳地，所述访问方式包括电话访问及网络访问，当所述访问方式为电话访问时，所述访问窗口包括散客电话窗口及商旅电话窗口，当所述访问方式为网络访问时，所述访问窗口包括散客登录页面及商旅登录页面。</p>
<p>较佳地，步骤 S3 中还为不同的访问权限设置不同的级别，并为级别更高的访问权限设置更大的网站服务的范围。</p>
<p><strong>本系统的目的在于还提供了一种网站账户访问权限的设置<font color="red">系统</font></strong>，其特点在于，包括 ：</p>
<ul>
<li>网站账户设置模块，用于为每个网站账户设置一唯一的身份标识码 ；</li>
<li>绑定模块，用于为每个网站账户绑定两个以上的访问权限，每个访问权限均列有所述网站账户的唯一的身份标识码、访问方式以及访问窗口之间的对应关系 ；</li>
<li>网站服务设置模块，用于为每个访问权限设置一对应的网站服务的范围 ；</li>
<li>查询模块，用于在接收到由一网站账户发出的访问请求后，从所述访问请求中查询出网站账户的身份标识码、访问方式以及访问窗口，并确定网站账户的访问权限 ；</li>
<li>网站服务提供模块，用于根据确定出的访问权限为网站账户提供对应的网站服务。</li>
</ul>
<p>较佳地，所述身份标识码为用户注册所述网站账户时输入的身份证号码、手机号码或邮箱地址。</p>
<p>较佳地，所述访问权限包括散客访问权限及商旅访问权限。</p>
<p>较佳地，所述访问方式包括电话访问及网络访问，当所述访问方式为电话访问时，所述访问窗口包括散客电话窗口及商旅电话窗口，当所述访问方式为网络访问时，所述访问窗口包括散客登录页面及商旅登录页面。</p>
<p>较佳地，所述网站服务设置模块还为不同的访问权限设置不同的级别，并为级别更高的访问权限设置更大的网站服务的范围。</p>
<p></p><p></p>
<p><div style="background:#4A4A4A;border-radius:8px;color:white;font-size:1.2em;">本系统的积极进步效果</div><br>本系统的积极进步效果在于 ：本系统能够采用访问方式及访问窗口等参数为同一个网站账户的不同身份设置不同的访问权限，从而很好地区分了同一个网站账户的不同身份，使得网站根据同一用户的不同访问及登录方式就能够为用户提供对应的不同范围的网<br>站服务，方便了网站对同一用户的多个身份进行统一服务和管理，同时也提升了用户的使用体验。</p>
<h2 id="附图说明"><a href="#附图说明" class="headerlink" title="附图说明"></a>附图说明</h2><p>图 1 为本发明的一较佳实施例的网站账户访问权限的设置系统的模块示意图。</p>
<p>图 2 为本发明的一较佳实施例的网站账户访问权限的设置方法的流程图。</p>
<h2 id="应用实例"><a href="#应用实例" class="headerlink" title="应用实例"></a>应用实例</h2><p>如图 1 所示，本发明的网站账户访问权限的设置系统包括一网站账户设置模块 1、一绑定模块 2、一网站服务设置模块3、一查询模块 4 以及一网站服务提供模块 5。</p>
<p>所述网站账户设置模块 1 为购物网站的每个网站账户设置一唯一的身份标识码，用户在购物网站上注册时需要输入一些个人身份信息，所述网站账户设置模块 1 就从网站的后台服务器的数据库中查询出与每个网站账户注册时输入的个人身份信息，并利用个人身份信息为每个网站账户设置唯一的身份标识码。</p>
<p>所述身份标识码会作为每个网站账户的唯一标示，以与其他账户区分开来，所述身份标识码具体可以为用户在注册网站账户时输入的身份证号码、手机号码或邮箱地址，而作为唯一标示，身份证号码、手机号码及邮箱地址的可信任级别则依次由高到低。</p>
<p>所述绑定模块 2 则为每个网站账户绑定两个以上的访问权限，在本实施例中，访问权限包括散客访问权限及商旅访问权限，而每个访问权限中均列有所述网站账户的唯一的身份标识码访问方式以及访问窗口之间的对应关系。具体地，访问方式可以包括电话访<br>问 (offline 访问操作，即针对线下的客服组的访问操作 ) 及网络访问 (online 访问操作，即在线的网络访问操作 )，当所述访问方式为电话访问时，所述访问窗口包括散客电话窗口及商旅电话窗口，以分别对应散客访问权限及商旅访问权限，此时用户的身份标识码优选地为手机号码，所述散客电话窗口例如可以是以 1010 开头的客服电话，所述商旅电话窗口例如可以是以 400 开头的客服电话。当所述访问方式为网络访问时，在购物网站上会分别设置散客登录界面及商旅登录界面，以分别对应散客访问权限及商旅访问权限，其中登录界面中需要输入的参数为用户网站账户的身份标识码，例如身份证号码或邮箱地址。</p>
<p>所述网站服务设置模块 3 则为每个访问权限设置对应的网站服务的范围，具体可以为不同的访问权限设置不同的级别，并为级别更高的访问权限设置更大的网站服务的范围，即对于散客访问权限和商旅访问权限，分别设置不同的网站服务，从而使得用户利用不同的访问权限访问网站时能够获得不同范围的网站服务，使得网站服务更具有针对性，同时也方便了用户的操作。例如，散客访问权限对应的网站服务可以有返还现金、使用支付宝、微信支付等第三方的支付方式，而商旅访问权限对应的网站服务可以在此基础上再增加按月结算账单等支付功能，并且二者所能够看到的商品种类和数量以及对应的价格也可以不相同。</p>
<p>当用户登录网站后，若需要某一网站服务，则可以直接发出访问请求，例如可以直接通过手机拨打网站的表征不同访问窗口的客服电话，如以 1010 开头或 400 开头的客服电话，此时的用户网站账户的身份标识码为手机号码，访问方式为电话访问，若拨打以 1010开头的客服电话，则访问窗口为散客电话窗口，此时对应散客访问权限，若拨打以 400 开头的客服电话，则访问窗口为商旅电话窗口，此时对应商旅访问权限 ；或者用户也可以通过网络访问，此时在购物网站上会分别设置散客登录界面及商旅登录界，用户可以选择其中的一个登录界面直接进行登录，此时的身份标识码为身份证号码或邮箱地址，访问方式则为网络访问，散客登录界面对应散客访问权限，商旅登录界面则对应商旅访问权限。</p>
<p>在用户发出访问请求后，所述查询模块 4 会从所述访问请求中查询出网站账户的身份标识码 ( 以确定唯一的用户身份 )、访问方式以及访问窗口 ( 具体如上所述 )，并根据上述查询出的信息来确定网站账户的访问权限 ( 即为散客访问权限还是商旅访问权限 )。</p>
<p>所述网站服务提供模块 5 则根据确定出的访问权限为网站账户提供对应的网站服务。</p>
<p>这样，利用本系统的网站账户访问权限的设置系统就能够采用访问方式及访问窗口等参数为同一个网站账户的不同身份设置不同的访问权限，实现了在不对用户的网站账户进行物理拆分和不对网站账户系统造成根本影响的前提下对用户网站账户的访问权限进行创建，使得网站根据同一用户的不同访问及登录方式就能够对用户的不同访问权限进行区分，从而为用户提供对应的不同范围的网站服务。</p>
<p>如图 2 所示，本发明利用本实施例的网站账户访问权限的设置系统实现的网站账户访问权限的设置方法包括以下步骤 ：</p>
<ul>
<li>步骤 101、为每个网站账户设置一唯一的身份标识码。</li>
<li>步骤 102、为每个网站账户绑定两个以上的访问权限，每个访问权限均列有所述网站账户的唯一的身份标识码、访问方式以及访问窗口之间的对应关系。</li>
<li>步骤 103、为每个访问权限设置一对应的网站服务的范围。</li>
<li>步骤 104、在接收到由一网站账户发出的访问请求后，从所述访问请求中查询出网站账户的身份标识码、访问方式以及访问窗口，并确定网站账户的访问权限。</li>
<li>步骤 105、根据步骤 104 中确定出的访问权限为网站账户提供对应的网站服务。</li>
</ul>
<p><img src="http://i1.piimg.com/5058a322b038ba16.png" alt=""></p>
<p><img src="http://i1.piimg.com/d42298ce36560953.png" alt=""></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/patent/">patent</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-project-manager-ctrip" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/06/02/project-manager-ctrip/" class="article-date">
  	<time datetime="2015-06-02T04:26:35.000Z" itemprop="datePublished">2015-06-02</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/02/project-manager-ctrip/">项目流程管理系统</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>本文所涉及到的专利是由 <strong>携程计算机技术（上海）有限公司</strong> 于 <strong>2015.01.28</strong> 申请。</p>
<h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p>本文公开了一种项目流程管理系统，包括用于确定项目的信息并将所述信息存入数据库、然后创建项目的进度计划及资源规划的项目初始化模块，用于记录并更新项目的操作日志以及项目中各个任务的状态、维护项目的信息的项目跟踪模块，用于进行项目的查询、查询结果的导出、以及根据查询结果获取相关统计结果的项目组合模块，用于筛选和用户信息相匹配的项目的信息、进度计划、资源规划，然后展示筛选结果的日历模块，以及用于提供看板以根据分类信息展示项目中的任务状态及所属版本的敏捷模块。本文的项目流程管理系统整合了完整的开发流程，规范了项目管理流程，使得项目开发阶段模板化，并且资源调配实时性、可视化，便于管理。</p>
<p><img src="http://i1.piimg.com/e74c35cbbc11abc5.png" alt=""></p>
<p>图1</p>
<p></p><p></p>
<div style="background:#4A4A4A;border-radius:8px;color:white;font-size:1.2em;">一种项目流程管理系统</div><br> 所述的项目流程管理系统，其特征在于，包括<strong>项目初始化模块</strong>、<strong>项目跟踪模块</strong>、<strong>项目组合模块</strong>、<strong>日历模块</strong>和<strong>敏捷模块</strong>；<br><br>所述<strong><em>项目初始化模块</em></strong>用于确定项目的信息并将所述信息存入数据库，并创建项目的进度计划及资源规划，其中，进度计划包括项目所包含的任务及任务中各个阶段的开始时间、完成时间和 / 或工作量，资源规划包括项目所占用的人员各个任务的工作量及工作时间；<br><br>所述<strong><em>项目跟踪模块</em></strong>用于记录并更新项目的操作日志以及项目中各个任务的状态，以及维护项目的信息 ；<br><br>所述<strong><em>项目组合模块</em></strong>用于进行项目的查询、查询结果的导出、以及根据查询结果获取与进度计划和 / 或资源规划相关的统计结果 ；<br><br>所述<strong><em>日历模块</em></strong>用于获取输入的用户信息，并筛选和所述用户信息相匹配的项目的信息、进度计划、资源规划，并以日历的形式展示筛选得到的结果 ；<br><br>所述<strong><em>敏捷模块</em></strong>用于提供若干看板，每一看板对应于一分类信息，每一看板用于根据对应的分类信息展示项目中的任务的状态及所属版本。<br><br><p><br><div style="background:#4A4A4A;border-radius:8px;color:white;font-size:1.2em;">甘特图</div><br>所述的项目流程管理系统，其特征在于，所述项目跟踪模块还用于提供以甘特图形式呈现的项目的进度计划以及接收输入的超链接并显示超链接链接的页面内容。<br><br></p><p><br><div style="background:#4A4A4A;border-radius:8px;color:white;font-size:1.2em;">面板工具模块</div><br>所述的项目流程管理系统，其特征在于，所述项目流程管理系统还包括面板工具模块，所述面板工具模块用于提供项目过滤、项目统计、二维项目过滤统计以及项目分组。<br><br></p><p><br><div style="background:#4A4A4A;border-radius:8px;color:white;font-size:1.2em;">报表模块</div><br>所述的项目流程管理系统，其特征在于，所述项目流程管理系统还包括报表模块，用于定制报表，所述报表包括以下几项中的至少一项 ：项目报表、结项报表、工作量统计报表、资源报表、交付报表。<br><br></p><p><br><div style="background:#4A4A4A;border-radius:8px;color:white;font-size:1.2em;">基于JIRA插件</div><br>任意一项所述的项目流程管理系统，其特征在于，所述项目流程管理系统基于 Jira 插件开发。<br><br>## 背景技术<br>Jira 是目前比较流行的<strong>基于 Java 架构的 B/S 缺陷跟踪管理系统</strong>，但其只能单一bug 跟踪、无法统一整合整个开发流程，市面上也没有包含了项目管理流程的相关 Jira 插件。<br><br>## 主要内容<br><br>本系统要解决的技术问题是为了克服现有技术中的项目流程管理系统无法统一整合完整的开发流程的缺陷，提出一种项目流程管理系统。<br></p><p><br><div style="background:#4A4A4A;border-radius:8px;color:white;font-size:1.2em;">通过下述技术方案来解决上述技术问题</div>


</p><p>本系统提供了一种项目流程管理系统，其特点在于，包括项目初始化模块、项目跟踪模块、项目组合模块、日历模块和敏捷模块。</p>
<p>其中，所述项目初始化模块用于确定项目的信息并将所述信息存入数据库，并创建项目的进度计划及资源规划，其中，进度计划包括项目所包含的任务及任务中各个阶段的开始时间、完成时间和 / 或工作量，资源规划包括项目所占用的人员各个任务的工作量<br>及工作时间。</p>
<p>所述项目跟踪模块用于记录并更新项目的操作日志以及项目中各个任务的状态，以及维护项目的信息。</p>
<p>所述项目组合模块用于进行项目的查询、查询结果的导出、以及根据查询结果获取与进度计划和 / 或资源规划相关的统计结果。</p>
<p>所述日历模块用于获取输入的用户信息，并筛选和所述用户信息相匹配的项目的信息、进度计划、资源规划，并以日历的形式展示筛选得到的结果。</p>
<p>所述敏捷模块用于提供若干看板，每一看板对应于一分类信息，每一看板用于根据对应的分类信息展示项目中的任务的状态及所属版本。</p>
<p>较佳地，所述项目跟踪模块还用于提供以甘特图形式呈现的项目的进度计划以及接收输入的超链接并显示超链接链接的页面内容。</p>
<p>较佳地，所述项目流程管理系统还包括面板工具模块，所述面板工具模块用于提供项目过滤、项目统计、二维项目过滤统计以及项目分组。</p>
<p>较佳地，所述项目流程管理系统还包括报表模块，用于定制报表，所述报表包括以下几项中的至少一项 ：项目报表、结项报表、工作量统计报表、资源报表、交付报表。</p>
<p>较佳地，所述项目流程管理系统基于 Jira 插件开发。</p>
<p>在符合本领域常识的基础上，上述各优选条件，可任意组合，即得本系统各较佳实例。</p>
<p></p><p></p>
<div style="background:#4A4A4A;border-radius:8px;color:white;font-size:1.2em;">本系统的积极进步效果</div><br>本系统的项目流程管理系统统一整合了完整的开发流程，能够规范项目管理流程，使得项目开发阶段模板化，并且资源调配实时性、可视化，便于管理。<br><br>图 1 为本系统一较佳实施例的项目流程管理系统的示意图。<br><br><p><br><div style="background:#4A4A4A;border-radius:8px;color:white;font-size:1.2em;">具体实施方式</div>

</p><p>下面结合附图给出本系统较佳实施例，以详细说明本系统的技术方案，但并不因此将本系统限制在所述的实施例范围之中。</p>
<p>参考图 1 所示，本实施例的项目流程管理系统是基于 Jira 插件开发，其包括项目初始化模块 1、项目跟踪模块 2、项目组合模块 3、日历模块 4、敏捷模块 5、面板工具模块 6 和报表模块 7。</p>
<p>其中，所述项目初始化模块 1 用于确定项目的信息并将所述信息存入数据库，并创建项目的进度计划及资源规划，其中，进度计划包括项目所包含的任务及任务中各个阶段的开始时间、完成时间和 / 或工作量，资源规划包括项目所占用的人员各个任务的工作<br>量及工作时间。</p>
<p>所述项目跟踪模块 2 用于记录并更新项目的操作日志以及项目中各个任务的状态、维护项目的信息、以及提供以甘特图形式呈现的项目的进度计划以及接收输入的超链接并显示超链接链接的页面内容。</p>
<p>所述项目组合模块 3 用于进行项目的查询、查询结果的导出、以及根据查询结果获取与进度计划和 / 或资源规划相关的统计结果。</p>
<p>所述日历模块 4 用于获取输入的用户信息，并筛选和所述用户信息相匹配的项目的信息、进度计划、资源规划，并以日历的形式展示筛选得到的结果。</p>
<p>所述敏捷模块 5 用于提供若干看板，每一看板对应于一分类信息，每一看板用于根据对应的分类信息展示项目中的任务的状态及所属版本。</p>
<p>所述面板工具模块 6 用于提供项目过滤、项目统计、二维项目过滤统计以及项目分组。</p>
<p>所述报表模块 7 用于定制报表，所述报表包括以下几项中的至少一项 ：项目报表、结项报表、工作量统计报表、资源报表、交付报表。</p>
<p></p><p></p>
<p><div style="background:#4A4A4A;border-radius:8px;color:white;font-size:1.2em;">应用实例</div><br>以下更具体地介绍本实施例的项目流程管理系统的应用实例，以便于更好理解本系统。</p>
<p>在这一应用实例中，所述项目流程管理系统部署在 <strong>linux 操作系统</strong>的基础上，数据库采用 <strong>MYSQL</strong>，以支持大多数主流的浏览器。</p>
<p>所述项目初始化模块 1 所承担的功能包括项目立项、项目规划。项目立项所需要的信息包括项目基本信息、ROI、干系人、辅助信息等，在立项时赋予项目 pool 值为“ <strong><em>意向</em></strong> ”。在立项审批通过后，项目 pool 值变为“ <strong><em>规划中</em></strong> ”，未通过则项目 pool 值变为“ <strong><em>已删除</em></strong> ”。在项目规划功能的应用中，主要包括以下流程，创建项目进度计划，进度计划中插件可由系统<br>管理员配置阶段模板，创建阶段时选择合适的模板，系统自动按模块中任务选择是否创建来创建一整套阶段、版本和任务。<span style="border-bottom:2px solid red">其中，版本和任务是 jira 自身的功能</span>，在系统中利用存下的版本与阶段的关联关系来使任务与项目关联</p>
<p>所述项目跟踪模块 2 在应用中所能够实现的功能包括以下几个方面 ：</p>
<ul>
<li><p>a) 进度计划功能可直接维护项目内的任务状态和经办人等信息 ；可直接看到资源规划与任务安排的工作量差异，并将任务的工作量覆盖规划阶段的资源规划结果 ；</p>
</li>
<li><p>b) 版本 +bug 功能，提供快捷创建 bug 功能，不只在项目中有此功能 ；同时该功能页嵌入 Jira 的 Project 主页面中，可直接在产品中找到项目并创建 bug ；</p>
</li>
<li><p>c) 甘特图功能，提供用户以甘特图形式查看项目进度计划 ；</p>
</li>
<li><p>d) 文档功能，提供用户填写超链接，直接显示链接的页面内容 ；</p>
</li>
<li><p>e) 变更功能，项目过程中发生计划、资源、产品变更时，使用变更功能提交变更申请，修改相关变更内容，并得到审批 ；</p>
</li>
<li><p>f) 提交规划功能，进度计划与资源规划完成后，提交规划即确认项目基线 , 项目Pool 值变为“ <strong><em>待确认规划</em></strong> ”；需要更改基线则通过提交变更方式来进行 ；</p>
</li>
<li><p>g) 确认规划功能 ：具有权限的用户可对项目 Pool 值变为“ <strong><em>待确认规划</em></strong> ”的项目进行审批，审批同意后项目 Pool 值变为“ <strong><em>进行中</em></strong> ”；</p>
</li>
<li><p>h) 结项功能 ：用户可提交项目结项申请及审批，并在提交申请或审批时关闭项目中所有版本和任务 ；提交结项申请后，项目 Pool 值变为“ <strong><em>待结项</em></strong> ”；结项审批拒绝后，可将项目 Pool 改为其他的 Pool 值 ；同意结项则项目 Pool 值变为“ <strong><em>已结项</em></strong> ”；</p>
</li>
<li><p>i) 日志功能 ：记录项目操作日志 ；</p>
</li>
<li><p>j) 备注功能 ：可对项目进行评论 ；</p>
</li>
</ul>
<ul>
<li><p>k) 关注功能 ：可为项目添加关注人，或主动关注项目 ；项目变化可通过系统通知邮件知晓 ；</p>
</li>
<li><p>l) 项目看板功能 ：直观展示项目下所有 issue 的状态和所有版本，不同甬道代表不同 issue 状态，issue 以卡片形式出现在甬道中，可在甬道间拖动来改变 issue 状态，也可直接拖动至版本改变 issue 所属版本 ；此功能界面也可直接创建 issue 和项目版本。</p>
</li>
</ul>
<p>所述项目组合模块 3 在应用中所能够实现的功能包括以下几个方面 ：</p>
<ul>
<li><p>a) 项目和项目集的查询功能，主要提供项目与项目集的查询和导出，对于查询结果可另存为过滤器 ；查询结果提供甘特视图、list 视图、详情视图、进度视图 ；</p>
</li>
<li><p>b) 项目分组功能，提供用户创建分组，将没有类似查询条件的项目或项目集放入分组 ；同时可分享分组和查询他人的分组 ；</p>
</li>
<li><p>c) 组织资源规划功能，提供用户直接按组织产品团队角色或按 HR 组查询，并以日历形式展示人员的资源规划情况 ；可直接操作将人员安排到组织内任何未确认规划的项目中 ；</p>
</li>
<li><p>d) 组织资源监控功能，提供用户按组织产品团队或按 HR 组资源利用情况统计结果查询 ；</p>
</li>
<li><p>e)组织和产品角色定义功能，建立系统内组织与 HR组管理、产品线与 Jira产品分类管理、产品与 JiraProject 关系，并提供用户维护产品角色人员，或维护人员的产品角色功能。</p>
</li>
</ul>
<p>所述日历模块 4 在应用中所能够实现的功能包括以下两个方面 ：</p>
<ul>
<li>a) 个人日历功能，以日历形式展示某个员工某月的资源规划结果、任务计划、参与的项目、以及维护个人事项 ；</li>
</ul>
<ul>
<li>b)HR 日历功能，以日历形式展示某 HR 组人员某月的资源规划结果、任务计划、参与的项目、以及个人事项 ；</li>
</ul>
<p>所述敏捷模块 5 在应用中所能够实现的功能包括以下多个方面 ：</p>
<ul>
<li>a) 项目看板功能，直观展示项目下所有 issue 的状态和所有版本，不同甬道代表不同 issue 状态，issue 以卡片形式出现在甬道中，可在甬道间拖动来改变 issue 状态，也可直接拖动至版本改变 issue 所属版本 ；此功能界面也可直接创建 issue 和项目版本 ；</li>
</ul>
<ul>
<li>b)HR 看板，直观展示某 HR 组下所有 issue 的状态和所有版本，不同甬道代表不同issue 状态，issue 以卡片形式出现在甬道中，可在甬道间拖动来改变 issue 状态，也可直接拖动至版本改变 issue 所属版本 ；</li>
</ul>
<ul>
<li><p>c)Sprint 看板，直观展示产品下所有 issue 的状态和所有版本，其中，</p>
<ul>
<li>i.Plan 页面，提供用户规划产品 Sprint 需要做的 issue，维护 sprint 状态 ；</li>
<li>ii.work 页面，维护某个 sprint 中 issue 的状态，不同甬道代表不同 issue 状态，issue 以卡片形式出现在甬道中,可在甬道间拖动来改变 issue 状态，也可直接拖动至版本改变 issue 所属版本。</li>
</ul>
</li>
</ul>
<p>所述面板工具模块 6 在应用中所能够实现的功能包括以下多个方面 ：</p>
<ul>
<li>a)二维项目过滤统计，利用项目过滤器，供用户自行选择 x轴与 y轴需要用来统计的字段</li>
</ul>
<ul>
<li>b) 项目分组，列表形式展示项目分组中项目信息，显示字段可由用户自行配置 ；</li>
</ul>
<ul>
<li>c) 项目统计，条状图形式展示，以项目过滤器为基础，用户可配置用来计算的字段 ；</li>
</ul>
<ul>
<li>d) 项目过滤，list 形式展示项目过滤器中项目信息，显示字段可由用户自行配置 ；</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/patent/">patent</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-tomcat-cluster-session-copy" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/05/29/tomcat-cluster-session-copy/" class="article-date">
  	<time datetime="2015-05-29T13:42:55.000Z" itemprop="datePublished">2015-05-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/29/tomcat-cluster-session-copy/">Tomcat集群之Session复制配置</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>感谢<a href="http://www.cnblogs.com/peter9/archive/2011/12/18/2362138.html" target="_blank" rel="external">原文编辑</a></p>
<p>因为最近的项目要用到多web服务器实现访问负载和集群，负载调度使用的是<strong>LVS</strong>，而非apache的负载调度，因为在高访问量和大并发量的时候LVS的性能比APACHE好。然后在web服务器上是使用tomcat5.5.25做应用服务器，对于tomcat的集群有两种方式，这个主要是针对 session而言的。一种就是 <strong>sticky模式</strong> ，即黏性会话模式；另外一种就是 <strong>session复制模式</strong> 了。</p>
<p>所谓sticky模式就是说同一个用户的访问请求都被派送到同一个tomcat实例上，这样我们就无须在多台服务器之间实现session共享了，这是其好处，不好的地方就是不能实现 failureover了，一但用户访问的机器挂掉，那么其session就会丢失。</p>
<p>而session复制模式就可以很好的解决failureover的问题，即使某一台web服务器挂掉了，用户的请求还会被负载到其他的web服务器上，而且session也被复制了，这样对用户而言就像是在同一台机器上操作一样，不好的地方就是session复制需要系统资源和网络的开销，尤其是当web服务器多的时候或session里存储的数据量大的时候，这点将会比较的明显（不过自己还没有做这方面的测试）。</p>
<p>针对这两种方式的弊端和好处，我们可以采用将两种方式结合的方式来达到更好的效果，那就是sticky+session复制模式了。用户的请求按照 sticky方式被分发到同一个web服务器上，同时tomcat在后台做异步复制（非同步）session到其他web服务器，这样我们使用 sticky的简便性，同时又有了一定的容错能力。</p>
<p>下面我就将自己的tomcat集群配置经验跟大家分享一下，呵呵。现在想来，其实tomcat的集群配置真的是非常简单，几乎不需要改什么东西了。我今天就在windows上用一台机器来跑两个tomcat实例，下面是一些基础条件：</p>
<p>1.两个tomcat的目录分别为：d:\apache-tomcat-5.5.25-node1和d:\apache-tomcat-5.5.25-node2</p>
<p>2.在每个tomcat目录下的conf\Catalina\localhost目录下建立一个ROOT.xml文件，其内容为：</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Context docBase=&quot;D:/mywebapps/test1&quot;
privileged=&quot;true&quot; antiResourceLocking=&quot;false&quot; antiJARLocking=&quot;false&quot; distributable=&quot;true&quot;&gt;
&lt;/Context&gt;
</code></pre><p>3.修改apache-tomcat-5.5.25-node1的connector端口为8091，修改apache-tomcat-5.5.25-node2的connector的端口为8092，这样是为了避免在同一机器上同时启动时造成访问端口冲突；</p>
<p>4.修改apache-tomcat-5.5.25-node2的Server端口为8006，与apache-tomcat-5.5.25-node1的Server端口8005不一样，也是避免两个tomcat实例启动时造成程序端口的冲突问题；</p>
<p>5.修改apache-tomcat-5.5.25-node2的AJP/1.3的端口为8019或其他非8009（默认）的端口，也是为了避免与apache-tomcat-5.5.25-node1的AJP/1.3端口冲突；</p>
<p>这样，我们就可以保证每一个tomcat单独启动时都可以提供D:/mywebapps/test1的web服务，注意是单个启动哦，然后分别启动 apache-tomcat-5.5.25-node1和apache-tomcat-5.5.25-node2后，输入如下地址分别进行访问你的web 应用：</p>
<p>apache-tomcat-5.5.25-node1的访问地址：<code>http：//localhost:8091/你的页面地址</code></p>
<p>apache-tomcat-5.5.25-node2的访问地址：<code>http：//localhost:8092/你的页面地址</code></p>
<p>如果你的tomcat没能成功的提供服务，那么你就需要查看一下是否tomcat部署成功了。注意这里的D:/mywebapps/test1就是你的web应用的物理路径了，可以随意修改。下面就开始对server.xml文件的配置了。</p>
<p>找到apache-tomcat-5.5.25-node1目录下的server.xml文件，打开并找到配置Engine的位置，我们在最后加入 jvmRoute=”node1”，表示这个tomcat的实例名称为node1。修改前后的对比如下：</p>
<p>修改前：</p>
<pre><code>&lt;Engine name=&quot;Catalina&quot; defaultHost=&quot;localhost&quot;&gt;
</code></pre><p>修改后：</p>
<pre><code>&lt;Engine name=&quot;Catalina&quot; defaultHost=&quot;localhost&quot; jvmRoute=&quot;node1&quot;&gt;
</code></pre><p>然后找到Cluster标签，并取消它的注释即可，无须做任何修改。同样，我们修改apache-tomcat-5.5.25-node2下的 server.xml文件，修改jvmRoute=”node2”，然后也是注释掉Cluster标签，注意，然后还要修改Cluster标签下的 Receiver标签的tcpListenPort端口号，我们改为4002（默认的是4001），这个是为了避免两个tomcat实例同时启动时造成冲突。</p>
<p>通过上面的配置后，我们两个tomcat已经配置完毕，并且可以完成集群任务了。注意启动的时候不能直接双击其bing目录下的 startup.bat文件，我们还需要为每一个tomcat设置环境变量，分别在apache-tomcat-5.5.25-node1和 apache-tomcat- 5.5.25-node2的根目录下编写一个bat文件，内容如下：</p>
<p>apache-tomcat-5.5.25-node1目录下的startup_node1.bat内容：</p>
<pre><code>set CATALINA_HOME=d:\apache-tomcat-5.5.25-node1
bin/startup.bat
</code></pre><p>apache-tomcat-5.5.25-node2目录下的startup_node2.bat内容：</p>
<pre><code>set CATALINA_HOME=d:\apache-tomcat-5.5.25-node2
bin/startup.bat
</code></pre><p>然后分别运行这两批处理文件即可正常启动tomcat了。我们先启动node1，双击startup_node1.bat启动node1。我们可以在窗口的最上面看到如下的输出信息：</p>
<pre><code>2008-1-4 19:12:24 org.apache.catalina.cluster.tcp.SimpleTcpCluster start
信息: Cluster is about to start
2008-1-4 19:12:25 org.apache.catalina.cluster.tcp.ReplicationTransmitter start
信息: Start ClusterSender at cluster Catalina:type=Cluster,host=localhost with n
ame Catalina:type=ClusterSender,host=localhost
2008-1-4 19:12:25 org.apache.catalina.cluster.mcast.McastServiceImpl setupSocket

信息: Setting cluster mcast soTimeout to 500
2008-1-4 19:12:25 org.apache.catalina.cluster.mcast.McastService start
信息: Sleeping for 2000 milliseconds to establish cluster membership
2008-1-4 19:12:27 org.apache.catalina.cluster.mcast.McastService registerMBean
信息: membership mbean registered (Catalina:type=ClusterMembership,host=localhos
t)
2008-1-4 19:12:27 org.apache.catalina.cluster.deploy.FarmWarDeployer start
信息: Cluster FarmWarDeployer started.
2008-1-4 19:12:29 org.apache.catalina.cluster.session.DeltaManager start
信息: Starting clustering manager...:
2008-1-4 19:12:29 org.apache.catalina.cluster.session.DeltaManager start
信息: Register manager to cluster element Host with name localhost
2008-1-4 19:12:29 org.apache.catalina.cluster.session.DeltaManager start
信息: Starting clustering manager at
2008-1-4 19:12:29 org.apache.catalina.cluster.session.DeltaManager getAllCluster
Sessions
信息: Manager []: skipping state transfer. No members active in cluster group.
</code></pre><p>这表明我们的tomcat集群已经正常启动了。然后我们再运行apache-tomcat-5.5.25-node2目录下的startup_node2.bat以启动node2。然后我们可以可以在窗口的最上方看到如下的信息输出：</p>
<pre><code>2008-1-4 19:16:32 org.apache.catalina.cluster.tcp.SimpleTcpCluster start
信息: Cluster is about to start
2008-1-4 19:16:32 org.apache.catalina.cluster.tcp.ReplicationTransmitter start
信息: Start ClusterSender at cluster Catalina:type=Cluster,host=localhost with n
ame Catalina:type=ClusterSender,host=localhost
2008-1-4 19:16:32 org.apache.catalina.cluster.mcast.McastServiceImpl setupSocket

信息: Setting cluster mcast soTimeout to 500
2008-1-4 19:16:32 org.apache.catalina.cluster.mcast.McastService start
信息: Sleeping for 2000 milliseconds to establish cluster membership
2008-1-4 19:16:32 org.apache.catalina.cluster.tcp.SimpleTcpCluster memberAdded
信息: Replication member added:org.apache.catalina.cluster.mcast.McastMember[tcp
://192.168.1.227:4001,catalina,192.168.1.227,4001, alive=245203]
2008-1-4 19:16:34 org.apache.catalina.cluster.mcast.McastService registerMBean
信息: membership mbean registered (Catalina:type=ClusterMembership,host=localhos
t)
2008-1-4 19:16:34 org.apache.catalina.cluster.deploy.FarmWarDeployer start
信息: Cluster FarmWarDeployer started.
2008-1-4 19:16:35 org.apache.catalina.cluster.session.DeltaManager start
信息: Starting clustering manager...:
2008-1-4 19:16:35 org.apache.catalina.cluster.session.DeltaManager start
信息: Register manager to cluster element Host with name localhost
2008-1-4 19:16:35 org.apache.catalina.cluster.session.DeltaManager start
信息: Starting clustering manager at
2008-1-4 19:16:35 org.apache.catalina.cluster.session.DeltaManager getAllCluster
Sessions
警告: Manager [], requesting session state from org.apache.catalina.cluster.mcas
t.McastMember[tcp://192.168.1.227:4001,catalina,192.168.1.227,4001, alive=248203
]. This operation will timeout if no session state has been received within 60 s
econds.
2008-1-4 19:16:35 org.apache.catalina.cluster.session.DeltaManager waitForSendAl
lSessions
</code></pre><p>请注意node2窗口输出的不同颜色部分，这个已经表示node2节点和node2节点联系上了。我们再回过来看node1窗口的输出信息，发现多出了如下的信息：</p>
<pre><code>2008-1-4 19:16:34 org.apache.catalina.cluster.tcp.SimpleTcpCluster memberAdded
信息: Replication member added:org.apache.catalina.cluster.mcast.McastMember[tcp
://192.168.1.227:4002,catalina,192.168.1.227,4002, alive=0]
</code></pre><p>这表明node1也已经侦听到了node2，两个tomcat服务器已经建立了联系。然后我们访问node1的一个地址A，假设这个地址A往 session里设置一个属性，然后我们再在同一窗口中访问node2的一个地址B，假设B是从session里读取这个属性，我们会发现B地址确实得到了这个刚刚我们在node1上设置进去的值。这里要特别注意的是，我们两个地址的分别访问必须是在同一个窗口中，因为我们没有做前端的web负载，所以使用不同的窗口进行访问会出现不同的session(因为端口号不一样,也就导致访问地址不一样了)，这样就导致无法查看的问题。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cluster/">cluster</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tomcat/">tomcat</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-lvs-info" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/05/29/lvs-info/" class="article-date">
  	<time datetime="2015-05-29T04:42:26.000Z" itemprop="datePublished">2015-05-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/29/lvs-info/">LVS三种负载均衡方式比较</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1、什么是LVS？"><a href="#1、什么是LVS？" class="headerlink" title="1、什么是LVS？"></a>1、什么是LVS？</h2><p>　　首先简单介绍一下LVS (Linux Virtual Server)到底是什么东西，其实它是一种集群(Cluster)技术，采用IP负载均衡技术和基于内容请求分发技术。调度器具有很好的吞吐率，将请求均衡地转移到不同的服务器上执行，且调度器自动屏蔽掉服务器的故障，从而将一组服务器构成一个高性能的、高可用的虚拟服务器。整个服务器集群的结构对客户是透明的，而且无需修改客户端和服务器端的程序。</p>
<p>　　为此，在设计时需要考虑系统的透明性、可伸缩性、高可用性和易管理性。一般来说，LVS集</p>
<p>　　群采用三层结构，其体系结构如图所示：</p>
<p><img src="http://i1.piimg.com/852ce2f7f65dba54.jpg" alt="LVS集群的体系结构"></p>
<p>　</p>
<h2 id="2、LVS主要组成部分为："><a href="#2、LVS主要组成部分为：" class="headerlink" title="2、LVS主要组成部分为："></a>2、LVS主要组成部分为：</h2><p>　　负载调度器(load balancer/ Director)，它是整个集群对外面的前端机，负责将客户的请求发送到一组服务器上执行，而客户认为服务是来自一个IP地址(我们可称之为虚拟IP地址)上的。</p>
<p>　　服务器池(server pool/ Realserver)，是一组真正执行客户请求的服务器，执行的服务一般有WEB、MAIL、FTP和DNS等。</p>
<p>　　共享存储(shared storage)，它为服务器池提供一个共享的存储区，这样很容易使得服务器池拥有相同的内容，提供相同的服务。</p>
<h2 id="3、LVS负载均衡方式"><a href="#3、LVS负载均衡方式" class="headerlink" title="3、LVS负载均衡方式:"></a>3、LVS负载均衡方式:</h2><h3 id="Virtual-Server-via-Network-Address-Translation-NAT-VS-NAT"><a href="#Virtual-Server-via-Network-Address-Translation-NAT-VS-NAT" class="headerlink" title="Virtual Server via Network Address Translation NAT(VS/NAT)"></a>Virtual Server via Network Address Translation NAT(VS/NAT)</h3><p>　　VS/NAT是一种最简单的方式，所有的RealServer只需要将自己的网关指向Director即可。客户端可以是任意操作系统，但此方式下，一个Director能够带动的RealServer比较有限。在VS/NAT的方式下，Director也可以兼为一台RealServer。VS/NAT的体系结构如图所示。</p>
<p><img src="http://i1.piimg.com/139671e0d1e9eb57.jpg" alt="　VS/NAT的体系结构"></p>
<h3 id="Virtual-Server-via-IP-Tunneling-VS-TUN"><a href="#Virtual-Server-via-IP-Tunneling-VS-TUN" class="headerlink" title="Virtual Server via IP Tunneling(VS/TUN)"></a>Virtual Server via IP Tunneling(VS/TUN)</h3><p>　　IP隧道(IP tunneling)是将一个IP报文封装在另一个IP报文的技术，这可以使得目标为一个IP地址的数据报文能被封装和转发到另一个IP地址。IP隧道技术亦称为IP封装技术(IP encapsulation)。IP隧道主要用于移动主机和虚拟私有网络(Virtual Private Network)，在其中隧道都是静态建立的，隧道一端有一个IP地址，另一端也有唯一的IP地址。它的连接调度和管理与VS/NAT中的一样，只是它的报文转发方法不同。调度器根据各个服务器的负载情况，动态地选择一台服务器，将请求报文封装在另一个IP报文中，再将封装后的IP报文转发给选出的服务器;服务器收到报文后，先将报文解封获得原来目标地址为 VIP 的报文，服务器发现VIP地址被配置在本地的IP隧道设备上，所以就处理这个请求，然后根据路由表将响应报文直接返回给客户。</p>
<p>　　VS/TUN的体系结构:</p>
<p><img src="http://i1.piimg.com/7b3e2f54bd659c69.jpg" alt=""></p>
<p>　　VS/TUN的工作流程：</p>
<p><img src="http://i1.piimg.com/78ae9814515c6a45.jpg" alt=""></p>
<h3 id="Virtual-Server-via-Direct-Routing-VS-DR"><a href="#Virtual-Server-via-Direct-Routing-VS-DR" class="headerlink" title="Virtual Server via Direct Routing(VS/DR)"></a>Virtual Server via Direct Routing(VS/DR)</h3><p>　　VS/DR方式是通过改写请求报文中的MAC地址部分来实现的。Director和RealServer必需在物理上有一个网卡通过不间断的局域网相连。 RealServer上绑定的VIP配置在各自Non-ARP的网络设备上(如lo或tunl),Director的VIP地址对外可见，而RealServer的VIP对外是不可见的。RealServer的地址即可以是内部地址，也可以是真实地址。</p>
<p>VS/DR的体系结构：</p>
<p><img src="http://i1.piimg.com/9105d9532616b843.jpg" alt=""></p>
<p>VS/DR的工作流程:</p>
<p>　　VS/DR的工作流程如图所示：它的连接调度和管理与VS/NAT和VS/TUN中的一样，它的报文转发方法又有不同，将报文直接路由给目标服务器。在VS/DR中，调度器根据各个服务器的负载情况，动态地选择一台服务器，不修改也不封装IP报文，而是将数据帧的MAC地址改为选出服务器的MAC地址，再将修改后的数据帧在与服务器组的局域网上发送。因为数据帧的MAC地址是选出的服务器，所以服务器肯定可以收到这个数据帧，从中可以获得该IP报文。当服务器发现报文的目标地址VIP是在本地的网络设备上，服务器处理这个报文，然后根据路由表将响应报文直接返回给客户。</p>
<p><img src="http://i1.piimg.com/78ae9814515c6a45.jpg" alt="VS/DR的工作流程"></p>
<p>　　VS/DR的工作流程</p>
<h2 id="4、三种负载均衡方式比较："><a href="#4、三种负载均衡方式比较：" class="headerlink" title="4、三种负载均衡方式比较："></a>4、三种负载均衡方式比较：</h2><h3 id="Virtual-Server-via-NAT"><a href="#Virtual-Server-via-NAT" class="headerlink" title="Virtual Server via NAT"></a>Virtual Server via NAT</h3><p>　　VS/NAT 的优点是服务器可以运行任何支持TCP/IP的操作系统，它只需要一个IP地址配置在调度器上，服务器组可以用私有的IP地址。缺点是它的伸缩能力有限，当服务器结点数目升到20时，调度器本身有可能成为系统的新瓶颈，因为在VS/NAT中请求和响应报文都需要通过负载调度器。我们在Pentium166 处理器的主机上测得重写报文的平均延时为60us，性能更高的处理器上延时会短一些。假设TCP报文的平均长度为536 Bytes，则调度器的最大吞吐量为8.93 MBytes/s. 我们再假设每台服务器的吞吐量为800KBytes/s，这样一个调度器可以带动10台服务器。(注：这是很早以前测得的数据)</p>
<p>　　基于 VS/NAT的的集群系统可以适合许多服务器的性能要求。如果负载调度器成为系统新的瓶颈，可以有三种方法解决这个问题：混合方法、VS/TUN和 VS/DR。在DNS混合集群系统中，有若干个VS/NAT负调度器，每个负载调度器带自己的服务器集群，同时这些负载调度器又通过RR-DNS组成简单的域名。</p>
<p>　　但VS/TUN和VS/DR是提高系统吞吐量的更好方法。</p>
<p>　　对于那些将IP地址或者端口号在报文数据中传送的网络服务，需要编写相应的应用模块来转换报文数据中的IP地址或者端口号。这会带来实现的工作量，同时应用模块检查报文的开销会降低系统的吞吐率。</p>
<h3 id="Virtual-Server-via-IP-Tunneling"><a href="#Virtual-Server-via-IP-Tunneling" class="headerlink" title="Virtual Server via IP Tunneling"></a>Virtual Server via IP Tunneling</h3><p>　　在VS/TUN 的集群系统中，负载调度器只将请求调度到不同的后端服务器，后端服务器将应答的数据直接返回给用户。这样，负载调度器就可以处理大量的请求，它甚至可以调度百台以上的服务器(同等规模的服务器)，而它不会成为系统的瓶颈。即使负载调度器只有100Mbps的全双工网卡，整个系统的最大吞吐量可超过 1Gbps。所以，VS/TUN可以极大地增加负载调度器调度的服务器数量。VS/TUN调度器可以调度上百台服务器，而它本身不会成为系统的瓶颈，可以用来构建高性能的超级服务器。VS/TUN技术对服务器有要求，即所有的服务器必须支持“IP Tunneling”或者“IP Encapsulation”协议。目前，VS/TUN的后端服务器主要运行Linux操作系统，我们没对其他操作系统进行测试。因为“IP Tunneling”正成为各个操作系统的标准协议，所以VS/TUN应该会适用运行其他操作系统的后端服务器。</p>
<h3 id="Virtual-Server-via-Direct-Routing"><a href="#Virtual-Server-via-Direct-Routing" class="headerlink" title="Virtual Server via Direct Routing"></a>Virtual Server via Direct Routing</h3><p>　　跟VS/TUN方法一样，VS/DR调度器只处理客户到服务器端的连接，响应数据可以直接从独立的网络路由返回给客户。这可以极大地提高LVS集群系统的伸缩性。跟VS/TUN相比，这种方法没有IP隧道的开销，但是要求负载调度器与实际服务器都有一块网卡连在同一物理网段上，服务器网络设备(或者设备别名)不作ARP响应，或者能将报文重定向(Redirect)到本地的Socket端口上。</p>
<p>　　三种LVS负载均衡技术的优缺点归纳以下表：</p>
<table class="table table-bordered"><br><tr><br><td></td><td>VS/NAT</td><td>VS/TUN</td><td>VS/DR</td><br></tr><br><tr><br><td>　服务器操作系统</td><td>任意</td><td>支持隧道</td><td>多数（支持Non-arp）</td><br></tr><br><tr><br><td>　服务器网络</td><td>私有网络</td><td>局域网/广域网</td><td>局域网</td><br></tr><br><tr><br><td>　服务器数目（100M网络）</td><td>10~20</td><td>100</td><td>大于100</td><br></tr><br><tr><br><td>　服务器网关</td><td>负载均衡器</td><td>自己的路由</td><td>自己的路由</td><br></tr><br><tr><br><td>　　效率</td><td>一般</td><td>高</td><td>最高</td><br></tr><br></table>

<p>　　注：以上三种方法所能支持最大服务器数目的估计是假设调度器使用100M网卡，调度器的硬件配置与后端服务器的硬件配置相同，而且是对一般Web服务。使 用更高的硬件配置(如千兆网卡和更快的处理器)作为调度器，调度器所能调度的服务器数量会相应增加。当应用不同时，服务器的数目也会相应地改变。所以，以上数据估计主要是为三种方法的伸缩性进行量化比较。</p>
<h2 id="5、负载均衡调度算法"><a href="#5、负载均衡调度算法" class="headerlink" title="5、负载均衡调度算法"></a>5、负载均衡调度算法</h2><p><strong>最少的连接方式(Least Connection)</strong>：传递新的连接给那些进行最少连接处理的服务器。当其中某个服务器发生第二到第7 层的故障，BIG-IP 就把其从服务器队列中拿出，不参加下一次的用户请求的分配, 直到其恢复正常。</p>
<p><strong>最快模式(Fastest)</strong>：传递连接给那些响应最快的服务器。当其中某个服务器发生第二到第7 层的故障，BIG-IP 就把其从服务器队列中拿出，不参加下一次的用户请求的分配，直到其恢复正常。</p>
<p><strong>观察模式(Observed)</strong>：连接数目和响应时间以这两项的最佳平衡为依据为新的请求选择服务器。当其中某个服务器发生第二到第7 层的故障，BIG-IP就把其从服务器队列中拿出，不参加下一次的用户请求的分配，直到其恢复正常。</p>
<p><strong>预测模式(Predictive)</strong>：BIG-IP利用收集到的服务器当前的性能指标，进行预测分析，选择一台服务器在下一个时间片内，其性能将达到最佳的服务器相应用户的请求。(被BIG-IP 进行检测)</p>
<p><strong>动态性能分配(Dynamic Ratio-APM)</strong>:BIG-IP 收集到的应用程序和应用服务器的各项性能参数，动态调整流量分配。</p>
<p><strong>动态服务器补充(Dynamic Server Act.)</strong>:当主服务器群中因故障导致数量减少时，动态地将备份服务器补充至主服务器群。</p>
<p><strong>服务质量(QoS)</strong>:按不同的优先级对数据流进行分配。</p>
<p><strong>服务类型(ToS)</strong>: 按不同的服务类型(在Type of Field中标识)负载均衡对数据流进行分配。</p>
<p><strong>规则模式</strong>：针对不同的数据流设置导向规则，用户可自行。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cluster/">cluster</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-export-htmltable2excel" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/05/28/export-htmltable2excel/" class="article-date">
  	<time datetime="2015-05-28T13:32:27.000Z" itemprop="datePublished">2015-05-28</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/28/export-htmltable2excel/">前端HTML中table对象导出到Excel</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>导出前端Table到Excel功能，如果后台去做， 的确可以忽略考虑浏览器的兼容性问题 ，但是后台需要用正则表达式进行匹配每行的数据，并且还要考虑合并单元格问题，复杂度很大 。</p>
<p>如果前端可以直接将table对象转换成excel通用对象的话，那么只要将table里的内容复制到excel中就能实现导出功能。以下程序就是在前端上实现下载到excel功能，不过缺陷是有浏览器的兼容性问题，需要利用ActiveXObject来开启Excel程序，以下程序只能在IE中实现。</p>
<pre><code>/**
 * ========================导出到Excel===================================================
 * 
 * 功能：HTML中Table对象转换为Excel通用对象.
 * 参数：tableID HTML中Table对象的ID属性值
 */
test._helper.exportToExcel  =  function(tableID){
      var tb = new TableToExcel(tableID);
      tb.setFontStyle(&quot;Courier New&quot;);
      tb.setFontSize(10);
      tb.setTableBorder(2);
      tb.setColumnWidth(7);
      tb.isLineWrap(true);
      tb.getExcelFile();
};
TableToExcel =     function(tableID) {

    this.tableBorder = -1; //边框类型，-1没有边框 可取1/2/3/4
    this.backGround = 0; //背景颜色：白色 可取调色板中的颜色编号 1/2/3/4....
    this.fontColor = 1; //字体颜色：黑色
    this.fontSize = 10; //字体大小
    this.fontStyle = &quot;宋体&quot;; //字体类型
    this.rowHeight = 20; //行高
    this.columnWidth = -1; //列宽
    this.lineWrap = true; //是否自动换行
    this.textAlign = -4108; //内容对齐方式 默认为居中
    this.autoFit = true; //是否自适应宽度
    this.tableID = tableID;
};

        TableToExcel.prototype.setTableBorder = function(excelBorder) {
            this.tableBorder = excelBorder;
        };
        TableToExcel.prototype.setBackGround = function(excelColor) {
            this.backGround = excelColor;
        };
        TableToExcel.prototype.setFontColor = function(excelColor) {
            this.fontColor = excelColor;
        };
        TableToExcel.prototype.setFontSize = function(excelFontSize) {
            this.fontSize = excelFontSize;
        };
        TableToExcel.prototype.setFontStyle = function(excelFont) {
            this.fontStyle = excelFont;
        };
        TableToExcel.prototype.setRowHeight = function(excelRowHeight) {
            this.rowHeight = excelRowHeight;
        };
        TableToExcel.prototype.setColumnWidth = function(excelColumnWidth) {
            this.columnWidth = excelColumnWidth;
        };
        TableToExcel.prototype.isLineWrap = function(lineWrap) {
            if (lineWrap == false || lineWrap == true) {
                this.lineWrap = lineWrap;
            }
        };
        TableToExcel.prototype.setTextAlign = function(textAlign) {
            this.textAlign = textAlign;
        };
        TableToExcel.prototype.isAutoFit = function(autoFit) {
            if (autoFit == true || autoFit == false)
                this.autoFit = autoFit;
        }
        //文件转换主函数
        TableToExcel.prototype.getExcelFile = function() {
            var jXls, myWorkbook, myWorksheet, myHTMLTableCell, myExcelCell, myExcelCell2;
            var myCellColSpan, myCellRowSpan;
            try {
                jXls = new ActiveXObject(&apos;Excel.Application&apos;);
            } catch (e) {
                if((!+&apos;/v1&apos;)) //ie浏览器 
                    alert(&quot;无法启动Excel,请使用IE浏览器进行该操作!\n\n如果您确信您的电脑中已经安装了Excel，&quot;
                        + &quot;那么请调整IE的安全级别。\n\n具体操作：\n\n&quot;
                        + &quot;工具 → Internet选项 → 安全 → 自定义级别 → 对没有标记为安全的ActiveX进行初始化和脚本运行 → 启用&quot;);
                else 
                     alert(&quot;请使用IE浏览器进行“导出到EXCEL”操作！&quot;);  //方便设置安全等级，限制为ie浏览器        
                return false;
            }
            //jXls.Visible = true;
            myWorkbook = jXls.Workbooks.Add();
            jXls.DisplayAlerts = false;
            myWorkbook.Worksheets(3).Delete();
            myWorkbook.Worksheets(2).Delete();
            jXls.DisplayAlerts = true;
            myWorksheet = myWorkbook.ActiveSheet;
            var readRow = 0, readCol = 0;
            var totalRow = 0, totalCol = 0;
            var tabNum = 0;
            //设置行高、列宽
            if (this.columnWidth != -1)
                myWorksheet.Columns.ColumnWidth = this.columnWidth;
            else
                myWorksheet.Columns.ColumnWidth = 7;
            if (this.rowHeight != -1)
                myWorksheet.Rows.RowHeight = this.rowHeight;
            //搜索需要转换的Table对象，获取对应行、列数
            var obj = document.all.tags(&quot;table&quot;);
            for (x = 0; x &lt; obj.length; x++) {
                if (obj[x].id == this.tableID) {
                    tabNum = x;
                    totalRow = obj[x].rows.length;
                    for (i = 0; i &lt; obj[x].rows[0].cells.length; i++) {
                        myHTMLTableCell = obj[x].rows(0).cells(i);
                        myCellColSpan = myHTMLTableCell.colSpan;
                        totalCol = totalCol + myCellColSpan;
                    }
                }
            }
            //开始构件模拟表格
            var excelTable = new Array();
            for (i = 0; i &lt;= totalRow; i++) {
                excelTable[i] = new Array();
                for (t = 0; t &lt;= totalCol; t++) {
                    excelTable[i][t] = false;
                }
            }
            //开始转换表格
            for (z = 0; z &lt; obj[tabNum].rows.length; z++) {
                readRow = z + 1;
                readCol = 0;
                for (c = 0; c &lt; obj[tabNum].rows(z).cells.length; c++) {
                    myHTMLTableCell = obj[tabNum].rows(z).cells(c);
                    myCellColSpan = myHTMLTableCell.colSpan;
                    myCellRowSpan = myHTMLTableCell.rowSpan;
                    for (y = 1; y &lt;= totalCol; y++) {
                        if (excelTable[readRow][y] == false) {
                            readCol = y;
                            break;
                        }
                    }
                    if (myCellColSpan * myCellRowSpan &gt; 1) {
                        myExcelCell = myWorksheet.Cells(readRow, readCol);
                        myExcelCell2 = myWorksheet.Cells(readRow
                                + myCellRowSpan - 1, readCol
                                + myCellColSpan - 1);
                        myWorksheet.Range(myExcelCell, myExcelCell2)
                                .Merge();
                        myExcelCell.HorizontalAlignment = this.textAlign;
                        myExcelCell.Font.Size = this.fontSize;
                        myExcelCell.Font.Name = this.fontStyle;
                        myExcelCell.wrapText = this.lineWrap;
                        myExcelCell.Interior.ColorIndex = this.backGround;
                        myExcelCell.Font.ColorIndex = this.fontColor;
                        if (this.tableBorder != -1) {
                            myWorksheet.Range(myExcelCell, myExcelCell2)
                                    .Borders(1).Weight = this.tableBorder;
                            myWorksheet.Range(myExcelCell, myExcelCell2)
                                    .Borders(2).Weight = this.tableBorder;
                            myWorksheet.Range(myExcelCell, myExcelCell2)
                                    .Borders(3).Weight = this.tableBorder;
                            myWorksheet.Range(myExcelCell, myExcelCell2)
                                    .Borders(4).Weight = this.tableBorder;
                        }
                        myExcelCell.Value = myHTMLTableCell.innerText;
                        for (row = readRow; row &lt;= myCellRowSpan + readRow
                                - 1; row++) {
                            for (col = readCol; col &lt;= myCellColSpan
                                    + readCol - 1; col++) {
                                excelTable[row][col] = true;
                            }
                        }
                        readCol = readCol + myCellColSpan;
                    } else {
                        myExcelCell = myWorksheet.Cells(readRow, readCol);
                        myExcelCell.Value = myHTMLTableCell.innerText;
                        myExcelCell.HorizontalAlignment = this.textAlign;
                        myExcelCell.Font.Size = this.fontSize;
                        myExcelCell.Font.Name = this.fontStyle;
                        myExcelCell.wrapText = this.lineWrap;
                        myExcelCell.Interior.ColorIndex = this.backGround;
                        myExcelCell.Font.ColorIndex = this.fontColor;
                        if (this.tableBorder != -1) {
                            myExcelCell.Borders(1).Weight = this.tableBorder;
                            myExcelCell.Borders(2).Weight = this.tableBorder;
                            myExcelCell.Borders(3).Weight = this.tableBorder;
                            myExcelCell.Borders(4).Weight = this.tableBorder;
                        }
                        excelTable[readRow][readCol] = true;
                        readCol = readCol + 1;
                    }
                }
            }
            if (this.autoFit == true)
                myWorksheet.Columns.AutoFit;
            jXls.UserControl = true;
            jXls.Visible = true;
            jXls = null;
            myWorkbook = null;
            myWorksheet = null;
        }; 
/**
 * ===================导出到Excel 结束===========================================
* */
</code></pre>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/html/">html</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-webservice-user" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/05/28/webservice-user/" class="article-date">
  	<time datetime="2015-05-28T08:32:04.000Z" itemprop="datePublished">2015-05-28</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/28/webservice-user/">Java创建WebService服务及客户端实现</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>WebService是一种服务的提供方式，通过WebService，不同应用间相互间调用变的很方便，网络上有很多常用的WebService服务，如：<a href="http://developer.51cto.com/art/200908/147125.htm" target="_blank" rel="external">http://developer.51cto.com/art/200908/147125.htm</a>，不同的语言平台对WebService都有实现，Java的WebService实现，比较流行的有Axis2、Jaxws，本文介绍的是Axis2。</p>
<h2 id="Axis2下载和部署"><a href="#Axis2下载和部署" class="headerlink" title="Axis2下载和部署"></a>Axis2下载和部署</h2><p>Axis2是Apache开发的一个开源项目，再次感叹Apache的伟大！<br>下载地址：<a href="http://mirror.bit.edu.cn/apache//axis/axis2/java/core/1.6.2/axis2-1.6.2-war.zip" target="_blank" rel="external"> http://mirror.bit.edu.cn/apache//axis/axis2/java/core/1.6.2/axis2-1.6.2-war.zip</a></p>
<p>将其内axis2.war解压到<tomcat安装目录>/webapps下，启动Tomcat，war包会自动解压，访问<a href="http://localhost:8080/axis2/" target="_blank" rel="external">http://localhost:8080/axis2/</a> ，如果看到欢迎主页，则说明部署成功。</tomcat安装目录></p>
<h2 id="配置Axis2"><a href="#配置Axis2" class="headerlink" title="配置Axis2"></a>配置Axis2</h2><p>＜Tomcat安装目录＞/webapps/axis2/WEB-INF/conf/axis2.xml，配置其内两个属性，以便调试。</p>
<pre><code>&lt;parameter name=&quot;hotdeployment&quot;&gt;true&lt;/parameter&gt;&lt;!-- 开启热部署，不需要重启即可部署服务 --&gt;  
&lt;parameter name=&quot;hotupdate&quot;&gt;true&lt;/parameter&gt;&lt;!-- 开启热更新，不需要重启即可更新服务 --&gt;
</code></pre><h2 id="编写服务"><a href="#编写服务" class="headerlink" title="编写服务"></a>编写服务</h2><p>所谓服务就是编写一个类，写一些方法，方法返回数据，WebService客户端获取数据。</p>
<pre><code>public class HelloService {  

    public String sayHello() {  
        return &quot;hello&quot;;  
    }  

}  
</code></pre><h2 id="配置POJO发布服务"><a href="#配置POJO发布服务" class="headerlink" title="配置POJO发布服务"></a>配置POJO发布服务</h2><p>服务类创建好后，我们需要发布到服务器上，将HelloService.class放到<tomcat安装目录>/webapps/axis2/WEB-INF/pojo下，pojo没有需要创建。</tomcat安装目录></p>
<p>至此，我们已经成功的创建了一个WebService服务了，so easy！<br>再次访问<a href="http://localhost:8080/axis2/" target="_blank" rel="external">http://localhost:8080/axis2/</a>，点击Services，可以发现可用services中多了一个HelloService，其内有一个可用操作sayHello，说明发布成功。</p>
<pre><code>HelloService  

Service Description : No description available for this service  

Service EPR : http://localhost:8080/axis2/services/HelloService  

Service Status : Active  


Available Operations  
sayHello  
</code></pre><p>访问<a href="http://localhost:8080/axis2/services/HelloService" target="_blank" rel="external">http://localhost:8080/axis2/services/HelloService</a>，页面输出正是我们的返回值。</p>
<pre><code>&lt;ns:sayHelloResponse xmlns:ns=&quot;http://ws.apache.org/axis2&quot;&gt;  
&lt;return&gt;hello&lt;/return&gt;  
&lt;/ns:sayHelloResponse&gt;  
</code></pre><p>这里有两点需要注意：</p>
<ul>
<li>POJO发布的类不能放在包里，既不能使用package关键字；</li>
<li>默认的发布目录是pojo，可以在<tomcat安装目录>/webapps/axis2/WEB-INF/conf/axis2.xml中增加目录，</tomcat安装目录></li>
</ul>
<pre><code>`&lt;deployer extension=&quot;.class&quot; directory=&quot;&lt;要增加的目录名称&gt;&quot; class=&quot;org.apache.axis2.deployment.POJODeployer&quot; /&gt;`
</code></pre><p>要注意多个目录见WebService要唯一，否则会重名，重名后，先部署的会成功，后部署的会报错。</p>
<h2 id="services-xml配置文件发布服务"><a href="#services-xml配置文件发布服务" class="headerlink" title="services.xml配置文件发布服务"></a>services.xml配置文件发布服务</h2><p>虽然POJO的方式不需要配置文件，但是其服务类不能放在包内，显然是不符合我们日常开发的，Axis2也允许带包的类发布WebService，如果不允许，估计就没人用了。</p>
<p>首先写一个较复杂的服务类，多个方法，带参数，有返回值的。</p>
<pre><code>package webservice.test;  

/** 
 * 计算器运算 
 *  
 * @author gaoshuang 
 */  
public class CalculateService {  

    // 加法  
    public float plus(float x, float y) {  
        return x + y;  
    }  

    // 减法  
    public float minus(float x, float y) {  
        return x - y;  
    }  

    // 乘法  
    public float multiply(float x, float y) {  
        return x * y;  
    }  

    // 除法  
    public float divide(float x, float y) {  
        if (y != 0)  
            return x / y;  
        else  
            return -1;  
    }  
}  
</code></pre><p>然后编写services.xml，该文件需要放在META-INF文件夹下。</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;  
&lt;!-- 服务名称 --&gt;  
&lt;service name=&quot;CalculateService&quot;&gt;  
    &lt;!-- 服务描述 --&gt;  
    &lt;description&gt;  
        加减乘除计算服务  
    &lt;/description&gt;  
    &lt;!-- 设置服务类 --&gt;  
    &lt;parameter name=&quot;ServiceClass&quot;&gt;  
        com.runqianapp.webservice.test.CalculateService  
    &lt;/parameter&gt;  
    &lt;!-- 方法 --&gt;  
    &lt;operation name=&quot;plus&quot;&gt;  
        &lt;!-- 方法处理器，RPCMessageReceiver为带返回值的处理器，  
                     RPCInOnlyMessageReceiver为不带返回值的处理器 --&gt;  
        &lt;messageReceiver mep=&quot;http://www.w3.org/2004/08/wsdl/in-out&quot;  
            class=&quot;org.apache.axis2.rpc.receivers.RPCMessageReceiver&quot; /&gt;  
    &lt;/operation&gt;  
    &lt;operation name=&quot;minus&quot;&gt;  
        &lt;messageReceiver mep=&quot;http://www.w3.org/2004/08/wsdl/in-out&quot;  
            class=&quot;org.apache.axis2.rpc.receivers.RPCMessageReceiver&quot; /&gt;  
    &lt;/operation&gt;  
    &lt;operation name=&quot;multiply&quot;&gt;  
        &lt;messageReceiver mep=&quot;http://www.w3.org/2004/08/wsdl/in-out&quot;  
            class=&quot;org.apache.axis2.rpc.receivers.RPCMessageReceiver&quot; /&gt;  
    &lt;/operation&gt;  
    &lt;operation name=&quot;divide&quot;&gt;  
        &lt;messageReceiver mep=&quot;http://www.w3.org/2004/08/wsdl/in-out&quot;  
            class=&quot;org.apache.axis2.rpc.receivers.RPCMessageReceiver&quot; /&gt;  
    &lt;/operation&gt;  
&lt;/service&gt;  
</code></pre><p> 最后将这两个文件打成jar包，不论用工具还是手动打，打的都是最外层的文件夹。</p>
<p><img src="http://i1.piimg.com/43f03797b1efef5c.png" alt=""></p>
<p>我打的名字是server.jar，更改后缀为aar，所以最后是server.aar，Axis2建议使用aar发布WebService， 将server.aar放到<tomcat安装目录>/webapps/axis2/WEB-INF/services下，访问<a href="http://localhost:8080/axis2/services/listServices" target="_blank" rel="external">http://localhost:8080/axis2/services/listServices</a>，多出了一个CalculateService，说明发布成功。</tomcat安装目录></p>
<pre><code>CalculateService  

Service Description : CalculateService  

Service EPR : http://localhost:8080/axis2/services/CalculateService  

Service Status : Active  


Available Operations  
divide  
plus  
minus  
multiply  
</code></pre><p>分别访问</p>
<p><a href="http://localhost:8080/axis2/services/CalculateService/plus?x=1&amp;y=2" target="_blank" rel="external">http://localhost:8080/axis2/services/CalculateService/plus?x=1&amp;y=2</a></p>
<p><a href="http://localhost:8080/axis2/services/CalculateService/divide?x=1&amp;y=2" target="_blank" rel="external"> http://localhost:8080/axis2/services/CalculateService/divide?x=1&amp;y=2</a></p>
<p><a href="http://localhost:8080/axis2/services/CalculateService/minus?x=1&amp;y=2" target="_blank" rel="external">http://localhost:8080/axis2/services/CalculateService/minus?x=1&amp;y=2</a>  </p>
<p><a href="http://localhost:8080/axis2/services/CalculateService/multiply?x=1&amp;y=2" target="_blank" rel="external">http://localhost:8080/axis2/services/CalculateService/multiply?x=1&amp;y=2</a>     </p>
<p>也可以发布多个WebService，可以使用serviceGroup标签。</p>
<pre><code>&lt;serviceGroup&gt;  
&lt;service name=&quot;myService1&quot;&gt;  
    ...  
&lt;/service&gt;  
&lt;service name=&quot;myService2&quot;&gt;  
    ...  
&lt;/service&gt;  
&lt;/serviceGroup&gt;  
</code></pre><h2 id="客户端实现"><a href="#客户端实现" class="headerlink" title="客户端实现"></a>客户端实现</h2><p>以上介绍的都是WebService服务创建及发布，那么有了一个WebService服务后，我们如何调用呢？只在浏览器上访问是没有意义的。</p>
<p>下载Axis2客户端压缩包：<a href="http://mirror.esocc.com/apache//axis/axis2/java/core/1.6.2/axis2-1.6.2-bin.zip" target="_blank" rel="external">http://mirror.esocc.com/apache//axis/axis2/java/core/1.6.2/axis2-1.6.2-bin.zip</a>，并解压。<br>新建工程WebServiceClientTest，将<axis2客户端安装目录>/lib下所有jar包添加到工程中；</axis2客户端安装目录></p>
<p>编写客户端代码；</p>
<pre><code>package webservice.client.test;  

import javax.xml.namespace.QName;  

import org.apache.axis2.AxisFault;  
import org.apache.axis2.addressing.EndpointReference;  
import org.apache.axis2.client.Options;  
import org.apache.axis2.rpc.client.RPCServiceClient;  

public class Client1 {  

    /** 
     * @param args 
     * @throws AxisFault 
     */  
    public static void main(String[] args) throws AxisFault {  
        // 使用RPC方式调用WebService  
        RPCServiceClient serviceClient = new RPCServiceClient();  
        Options options = serviceClient.getOptions();  
        // 指定调用WebService的URL  
        EndpointReference targetEPR = new EndpointReference(  
                &quot;http://localhost:8080/axis2/services/CalculateService&quot;);  
        options.setTo(targetEPR);  
        // 调用方法的参数值  
        Object[] entryArgs = new Object[] {1, 2};  
        // 调用方法返回值的数据类型的Class对象  
        Class[] classes = new Class[] { float.class };  
        // 调用方法名及WSDL文件的命名空间  
        // 命名空间是http://localhost:8080/axis2/services/CalculateService?wsdl中wsdl:definitions标签targetNamespace属性  
        QName opName = new QName(&quot;http://test.webservice&quot;, &quot;plus&quot;);  
        // 执行方法获取返回值  
        // 没有返回值的方法使用serviceClient.invokeRobust(opName, entryArgs)  
        Object result = serviceClient.invokeBlocking(opName, entryArgs, classes)[0];  
        System.out.println(result);  
        // out: 3.0  
    }  

}  
</code></pre><p>以上是实现了一个简单的WebSerivce客户端，调用CalculateService中的plus方法，由代码可见，这种调用方式比较杂乱，代码不太友好。</p>
<h2 id="wsdl2java简化客户端"><a href="#wsdl2java简化客户端" class="headerlink" title="wsdl2java简化客户端"></a>wsdl2java简化客户端</h2><p>Axis2客户端安装目录&gt;/bin目录，其内有两个bat，wsdl2java.bat和java2wsdl.bat，可以实现WSDL文件和Java之间的互相转换。</p>
<p>考虑到我们以后可能经常使用这些命令，设置环境变量，方便以后调用。在系统变量中加入AXIS2_HOME=<axis2客户端安装目录>，path中追加;%AXIS2_HOME%\bin。</axis2客户端安装目录></p>
<p>启动命令提示符，进入WebServiceTestClient所在目录，运行</p>
<pre><code>wsdl2java -uri http://localhost:8080/axis2/services/CalculateService?wsdl -p webservice.client.test -s  
</code></pre><p>参数说明：uri - wsdl文件路径，网络路径或本地路径，p - 打包，这里和上一个客户端实现类打在了一个包里，wsdl2java有很多参数，详细可以运行该命令去查看。</p>
<p> 执行后，如果没有报错，说明运行成功，刷新项目，该包下多出了一个CalculateServiceStub类，里面的代码极其复杂，还乱呼呼的，这我们不用管，调用该类。</p>
<pre><code>package webservice.client.test;  

import java.rmi.RemoteException;  

import webservice.client.test.CalculateServiceStub.Plus;  

public class Client2 {  

    /** 
     * @param args 
     * @throws RemoteException  
     */  
    public static void main(String[] args) throws RemoteException {  
        CalculateServiceStub stub = new CalculateServiceStub();  
        Plus plus = new Plus();  
        plus.setX(1);  
        plus.setY(2);  
        float result = stub.plus(plus).get_return();// 返回值自动转型，这也是强大之处  
        System.out.println(result);  
    }  

}  
</code></pre><p>如此做的好处就是调用时不需要在去查看WSDL，和正常使用一个类一样，对WebService的封装都由wsdl2java自动生成，代码更优雅、简洁。</p>
<h2 id="利用wsdl2java轻松使用第三方WebService服务"><a href="#利用wsdl2java轻松使用第三方WebService服务" class="headerlink" title="利用wsdl2java轻松使用第三方WebService服务"></a>利用wsdl2java轻松使用第三方WebService服务</h2><p>有了wsdl2java，已知一个WSDL文件我们就可以轻松的生成WebService客户端供我们调用，给我们服务。</p>
<p>文章开头给出的链接包含了一些第三方服务，有一个服务是生成随机个数中文，WSDL：<a href="http://www.webxml.com.cn/WebServices/RandomFontsWebService.asmx?wsdl" target="_blank" rel="external">http://www.webxml.com.cn/WebServices/RandomFontsWebService.asmx?wsdl</a>，同样，启动命令提示符，进入项目路径，执行</p>
<pre><code>wsdl2java -uri http://www.webxml.com.cn/WebServices/RandomFontsWebService.asmx?wsdl -p webservice.client.test -s  
</code></pre><p>调用该类</p>
<pre><code>package webservice.client.test;  

import java.rmi.RemoteException;  

import webservice.client.test.RandomFontsWebServiceStub.ArrayOfString;  
import webservice.client.test.RandomFontsWebServiceStub.GetChineseFonts;  

public class ThirdClient {  

    /** 
     * @param args 
     * @throws RemoteException  
     */  
    public static void main(String[] args) throws RemoteException {  
        RandomFontsWebServiceStub stub = new RandomFontsWebServiceStub();  
        GetChineseFonts getChineseFonts = new GetChineseFonts();  
        getChineseFonts.setByFontsLength(10);// 免费使用有限制，最多8个  
        ArrayOfString result = stub.getChineseFonts(getChineseFonts).getGetChineseFontsResult();  
        for(String str : result.getString()) {  
            System.out.println(str);  
        }  
    }  

}  
</code></pre><h2 id="源码下载"><a href="#源码下载" class="headerlink" title="源码下载"></a>源码下载</h2><p>文中代码尽在下面链接中，免积分下载。</p>
<p><a href="http://download.csdn.net/download/ghsau/6400843" target="_blank" rel="external">http://download.csdn.net/download/ghsau/6400843</a><br>(完)</p>
<p>本文来自：<a href="&quot;http://blog.csdn.net/ghsau&quot;">高爽|Coder</a>，原文地址：<a href="http://blog.csdn.net/ghsau/article/details/12714965" target="_blank" rel="external">http://blog.csdn.net/ghsau/article/details/12714965</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webservice/">webservice</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-webservice-resource" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/05/28/webservice-resource/" class="article-date">
  	<time datetime="2015-05-28T04:31:50.000Z" itemprop="datePublished">2015-05-28</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/28/webservice-resource/">WebService资源整理</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>现成的Web Service中有很多很好用的，比如天气预报，IP地址搜索，火车时刻表等等。本文汇总的一些常用Web Service，希望对大家有所帮助。</p>
<p>感谢<a href="&quot;http://developer.51cto.com/art/200908/147125.htm&quot;">原文编辑</a></p>
<p>天气预报Web Service，数据来源于中国气象局</p>
<ol>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/WeatherWebService.asmx&quot;">Endpoint</a></li>
<li><a href="http://www.webxml.com.cn/WebServices/WeatherWebService.asmx?disco" title="Disco" target="_blank" rel="external">Disco</a></li>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/WeatherWebService.asmx?wsdl&quot;">WSDL</a></li>
</ol>
<p>IP地址来源搜索Web Service（是目前最完整的IP地址数据）</p>
<ol>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/IpAddressSearchWebService.asmx&quot;">Endpoint</a></li>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/IpAddressSearchWebService.asmx?disco&quot;">Disco</a></li>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/IpAddressSearchWebService.asmx?wsdl&quot;">WSDL</a></li>
</ol>
<p>随机英文、数字和中文简体字Web Service</p>
<ol>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/RandomFontsWebService.asmx&quot;">Endpoint</a></li>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/RandomFontsWebService.asmx?disco&quot;">Disco</a></li>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/RandomFontsWebService.asmx？wsdl&quot;">WSDL</a></li>
</ol>
<p>中国邮政编码 &lt;-&gt; 地址信息双向查询/搜索Web Service</p>
<ol>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/ChinaZipSearchWebService.asmx&quot;">Endpoint</a></li>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/ChinaZipSearchWebService.asmx?disco&quot;">Disco</a></li>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/ChinaZipSearchWebService.asmx?wsdl&quot;">WSDL</a></li>
</ol>
<p>验证码图片Web Service 支持中文、字母、数字 图像和多媒体</p>
<ol>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/ValidateCodeWebService.asmx&quot;">Endpoint</a></li>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/ValidateCodeWebService.asmx?disco&quot;">Disco</a></li>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/ValidateCodeWebService.asmx?wsdl&quot;">WSDL</a></li>
</ol>
<p>Email 电子邮件地址验证Web Service</p>
<ol>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/ValidateEmailWebService.asmx&quot;">Endpoint</a></li>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/ValidateEmailWebService.asmx?disco&quot;">Disco</a></li>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/ValidateEmailWebService.asmx?wsdl&quot;">WSDL</a></li>
</ol>
<p>中文简体字 &lt;-&gt;繁体字转换Web Service</p>
<ol>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/TranslatorWebService.asmx&quot;">Endpoint</a></li>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/TranslatorWebService.asmx?disco&quot;">Disco</a></li>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/TranslatorWebService.asmx?wsdl&quot;">WSDL</a></li>
</ol>
<p>火车时刻表Web Service （第六次提速最新列车时刻表）</p>
<ol>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/TrainTimeWebService.asmx&quot;">Endpoint</a></li>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/TrainTimeWebService.asmx?disco&quot;">Disco</a></li>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/TrainTimeWebService.asmx?wsdl&quot;">WSDL</a></li>
</ol>
<p>中国股票行情数据Web Service（支持深圳和上海股市的基金、债券和股票）</p>
<ol>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/ChinaStockWebService.asmx&quot;">Endpoint</a></li>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/ChinaStockWebService.asmx?disco&quot;">Disco</a></li>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/ChinaStockWebService.asmx?wsdl&quot;">WSDL</a></li>
</ol>
<p>即时外汇汇率数据Web Service</p>
<ol>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/ExchangeRateWebService.asmx&quot;">Endpoint</a></li>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/ExchangeRateWebService.asmx?disco&quot;">Disco</a></li>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/ExchangeRateWebService.asmx?wsdl&quot;">WSDL</a></li>
</ol>
<p>腾讯QQ在线状态Web Service</p>
<ol>
<li><a href="&quot;http://www.webxml.com.cn/webservices/qqOnlineWebService.asmx&quot;">Endpoint</a></li>
<li><a href="&quot;http://www.webxml.com.cn/webservices/qqOnlineWebService.asmx?disco&quot;">Disco</a></li>
<li><a href="&quot;http://www.webxml.com.cn/webservices/qqOnlineWebService.asmx?wsdl&quot;">WSDL</a></li>
</ol>
<p>中国电视节目预告（电视节目表）Web Service</p>
<ol>
<li><a href="&quot;http://www.webxml.com.cn/webservices/ChinaTVprogramWebService.asmx&quot;">Endpoint</a></li>
<li><a href="&quot;http://www.webxml.com.cn/webservices/ChinaTVprogramWebService.asmx?disco&quot;">Disco</a></li>
<li><a href="&quot;http://www.webxml.com.cn/webservices/ChinaTVprogramWebService.asmx?wsdl&quot;">WSDL</a></li>
</ol>
<p>外汇-人民币即时报价Web Service</p>
<ol>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/ForexRmbRateWebService.asmx&quot;">Endpoint</a></li>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/ForexRmbRateWebService.asmx?disco&quot;">Disco</a></li>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/ForexRmbRateWebService.asmx?wsdl&quot;">WSDL</a></li>
</ol>
<p>中国股票行情分时走势预览缩略图Web Service</p>
<ol>
<li><a href="&quot;http://www.webxml.com.cn/webservices/ChinaStockSmallImageWS.asmx&quot;">Endpoint</a></li>
<li><a href="&quot;http://www.webxml.com.cn/webservices/ChinaStockSmallImageWS.asmx?disco&quot;">Disco</a></li>
<li><a href="&quot;http://www.webxml.com.cn/webservices/ChinaStockSmallImageWS.asmx?wsdl&quot;">WSDL</a></li>
</ol>
<p>国内飞机航班时刻表 Web Service</p>
<ol>
<li><a href="&quot;http://www.webxml.com.cn/webservices/DomesticAirline.asmx&quot;">Endpoint</a></li>
<li><a href="&quot;http://www.webxml.com.cn/webservices/DomesticAirline.asmx?disco&quot;">Disco</a></li>
<li><a href="&quot;http://www.webxml.com.cn/webservices/DomesticAirline.asmx?wsdl&quot;">WSDL</a></li>
</ol>
<p>中国开放式基金数据Web Service</p>
<ol>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/ChinaOpenFundWS.asmx&quot;">Endpoint</a></li>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/ChinaOpenFundWS.asmx?disco&quot;">Disco</a></li>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/ChinaOpenFundWS.asmx?wsdl&quot;">WSDL</a></li>
</ol>
<p>股票行情数据 Web Service（支持香港、深圳、上海基金、债券和股票；支持多股票同时查询）</p>
<ol>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/StockInfoWS.asmx&quot;">Endpoint</a></li>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/StockInfoWS.asmx?disco&quot;">Disco</a></li>
<li><a href="&quot;http://www.webxml.com.cn/WebServices/StockInfoWS.asmx?wsdl&quot;">WSDL</a></li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/recource/">recource</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-getlunnarday" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/05/28/getlunnarday/" class="article-date">
  	<time datetime="2015-05-28T01:31:11.000Z" itemprop="datePublished">2015-05-28</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/28/getlunnarday/">根据阳历日期获取农历日期</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>以下程序基于Jquery实现的阴阳历的转换功能，尤其是在实现日程日历管理的时候，阴阳历转换功能是比较常见的。只要将以下内容拷贝到自己的程序中，使用的时候只要调用</p>
<pre><code>test._helper.GetLunarDay（&quot;2015&quot;, &quot;05&quot;,&quot;27&quot;）；
</code></pre><p>输出</p>
<pre><code>四月初十
</code></pre><p>GetLunarDay.js</p>
<pre><code>var test = (function($) {

        var test = {};

        test._helper = {};

        test._helper.GetLunarDay =  function(YearStr, MonthStr, DayStr) {
            var sDObj = new Date(parseInt(YearStr), parseInt(MonthStr) - 1,
                    parseInt(DayStr));
            var lDObj = new Lunar(sDObj) ;//农历   
            return cMonth(lDObj.month) + cDay(lDObj.day);
        }

        var lunarInfo = new Array(0x04bd8, 0x04ae0, 0x0a570, 0x054d5,
                0x0d260, 0x0d950, 0x16554, 0x056a0, 0x09ad0, 0x055d2,
                0x04ae0, 0x0a5b6, 0x0a4d0, 0x0d250, 0x1d255, 0x0b540,
                0x0d6a0, 0x0ada2, 0x095b0, 0x14977, 0x04970, 0x0a4b0,
                0x0b4b5, 0x06a50, 0x06d40, 0x1ab54, 0x02b60, 0x09570,
                0x052f2, 0x04970, 0x06566, 0x0d4a0, 0x0ea50, 0x06e95,
                0x05ad0, 0x02b60, 0x186e3, 0x092e0, 0x1c8d7, 0x0c950,
                0x0d4a0, 0x1d8a6, 0x0b550, 0x056a0, 0x1a5b4, 0x025d0,
                0x092d0, 0x0d2b2, 0x0a950, 0x0b557, 0x06ca0, 0x0b550,
                0x15355, 0x04da0, 0x0a5d0, 0x14573, 0x052d0, 0x0a9a8,
                0x0e950, 0x06aa0, 0x0aea6, 0x0ab50, 0x04b60, 0x0aae4,
                0x0a570, 0x05260, 0x0f263, 0x0d950, 0x05b57, 0x056a0,
                0x096d0, 0x04dd5, 0x04ad0, 0x0a4d0, 0x0d4d4, 0x0d250,
                0x0d558, 0x0b540, 0x0b5a0, 0x195a6, 0x095b0, 0x049b0,
                0x0a974, 0x0a4b0, 0x0b27a, 0x06a50, 0x06d40, 0x0af46,
                0x0ab60, 0x09570, 0x04af5, 0x04970, 0x064b0, 0x074a3,
                0x0ea50, 0x06b58, 0x055c0, 0x0ab60, 0x096d5, 0x092e0,
                0x0c960, 0x0d954, 0x0d4a0, 0x0da50, 0x07552, 0x056a0,
                0x0abb7, 0x025d0, 0x092d0, 0x0cab5, 0x0a950, 0x0b4a0,
                0x0baa4, 0x0ad50, 0x055d9, 0x04ba0, 0x0a5b0, 0x15176,
                0x052b0, 0x0a930, 0x07954, 0x06aa0, 0x0ad50, 0x05b52,
                0x04b60, 0x0a6e6, 0x0a4e0, 0x0d260, 0x0ea65, 0x0d530,
                0x05aa0, 0x076a3, 0x096d0, 0x04bd7, 0x04ad0, 0x0a4d0,
                0x1d0b6, 0x0d250, 0x0d520, 0x0dd45, 0x0b5a0, 0x056d0,
                0x055b2, 0x049b0, 0x0a577, 0x0a4b0, 0x0aa50, 0x1b255,
                0x06d20, 0x0ada0)

        var solarMonth = new Array(31, 28, 31, 30, 31, 30, 31, 31, 30, 31,
                30, 31);
        var Gan = new Array(&quot;甲&quot;, &quot;乙&quot;, &quot;丙&quot;, &quot;丁&quot;, &quot;戊&quot;, &quot;己&quot;, &quot;庚&quot;, &quot;辛&quot;, &quot;壬&quot;,
                &quot;癸&quot;);
        var Zhi = new Array(&quot;子&quot;, &quot;丑&quot;, &quot;寅&quot;, &quot;卯&quot;, &quot;辰&quot;, &quot;巳&quot;, &quot;午&quot;, &quot;未&quot;, &quot;申&quot;,
                &quot;酉&quot;, &quot;戌&quot;, &quot;亥&quot;);
        var Animals = new Array(&quot;鼠&quot;, &quot;牛&quot;, &quot;虎&quot;, &quot;兔&quot;, &quot;龙&quot;, &quot;蛇&quot;, &quot;马&quot;, &quot;羊&quot;,
                &quot;猴&quot;, &quot;鸡&quot;, &quot;狗&quot;, &quot;猪&quot;);
        var solarTerm = new Array(&quot;小寒&quot;, &quot;大寒&quot;, &quot;立春&quot;, &quot;雨水&quot;, &quot;惊蛰&quot;, &quot;春分&quot;, &quot;清明&quot;,
                &quot;谷雨&quot;, &quot;立夏&quot;, &quot;小满&quot;, &quot;芒种&quot;, &quot;夏至&quot;, &quot;小暑&quot;, &quot;大暑&quot;, &quot;立秋&quot;, &quot;处暑&quot;, &quot;白露&quot;,
                &quot;秋分&quot;, &quot;寒露&quot;, &quot;霜降&quot;, &quot;立冬&quot;, &quot;小雪&quot;, &quot;大雪&quot;, &quot;冬至&quot;)
        var sTermInfo = new Array(0, 21208, 42467, 63836, 85337, 107014,
                128867, 150921, 173149, 195551, 218072, 240693, 263343,
                285989, 308563, 331033, 353350, 375494, 397447, 419210,
                440795, 462224, 483532, 504758)
        var nStr1 = new Array(&apos;日&apos;, &apos;一&apos;, &apos;二&apos;, &apos;三&apos;, &apos;四&apos;, &apos;五&apos;, &apos;六&apos;, &apos;七&apos;, &apos;八&apos;,
                &apos;九&apos;, &apos;十&apos;);
        var nStr2 = new Array(&apos;初&apos;, &apos;十&apos;, &apos;廿&apos;, &apos;卅&apos;, &apos;　&apos;);
        var monthName = new Array(&quot;JAN&quot;, &quot;FEB&quot;, &quot;MAR&quot;, &quot;APR&quot;, &quot;MAY&quot;, &quot;JUN&quot;,
                &quot;JUL&quot;, &quot;AUG&quot;, &quot;SEP&quot;, &quot;OCT&quot;, &quot;NOV&quot;, &quot;DEC&quot;);

        /*****************************************************************************   
                       日期计算   
         *****************************************************************************/

        //======================================   传回农历   y年的总天数   
        function lYearDays(y) {
            var i, sum = 348
            for (i = 0x8000; i &gt; 0x8; i &gt;&gt;= 1)
                sum += (lunarInfo[y - 1900] &amp; i) ? 1 : 0
            return (sum + leapDays(y))
        }

        //======================================   传回农历   y年闰月的天数   
        function leapDays(y) {
            if (leapMonth(y))
                return ((lunarInfo[y - 1900] &amp; 0x10000) ? 30 : 29)
            else
                return (0);
        }

        //======================================   传回农历   y年闰哪个月   1-12   ,   没闰传回   0   
        function leapMonth(y) {
            return (lunarInfo[y - 1900] &amp; 0xf);
        }

        //======================================   传回农历   y年m月的总天数   
        function monthDays(y, m) {
            return ((lunarInfo[y - 1900] &amp; (0x10000 &gt;&gt; m)) ? 30 : 29);
        }

        //======================================   算出农历,   传入日期物件,   传回农历日期物件   
        //                                                                               该物件属性有   .year   .month   .day   .isLeap   .yearCyl   .dayCyl   .monCyl   
        function Lunar(objDate) {

            var i, leap = 0, temp = 0;
            var baseDate = new Date(1900, 0, 31);
            var offset = (objDate - baseDate) / 86400000;

            this.dayCyl = offset + 40;
            this.monCyl = 14;

            for (i = 1900; i &lt; 2050 &amp;&amp; offset &gt; 0; i++) {
                temp = lYearDays(i);
                offset -= temp
                this.monCyl += 12;
            }

            if (offset &lt; 0) {
                offset += temp;
                i--;
                this.monCyl -= 12;
            }

            this.year = i;
            this.yearCyl = i - 1864;

            leap = leapMonth(i); //闰哪个月   
            this.isLeap = false;

            for (i = 1; i &lt; 13 &amp;&amp; offset &gt; 0; i++) {
                //闰月   
                if (leap &gt; 0 &amp;&amp; i == (leap + 1) &amp;&amp; this.isLeap == false) {
                    --i;
                    this.isLeap = true;
                    temp = leapDays(this.year);
                } else {
                    temp = monthDays(this.year, i);
                }

                //解除闰月   
                if (this.isLeap == true &amp;&amp; i == (leap + 1))
                    this.isLeap = false;

                offset -= temp;
                if (this.isLeap == false)
                    this.monCyl++;
            }

            if (offset == 0 &amp;&amp; leap &gt; 0 &amp;&amp; i == leap + 1)
                if (this.isLeap) {
                    this.isLeap = false;
                } else {
                    this.isLeap = true;
                    --i;
                    --this.monCyl;
                }

            if (offset &lt; 0) {
                offset += temp;
                --i;
                --this.monCyl;
            }

            this.month = i;
            this.day = offset + 1;
        }

        //==============================传回国历   y年某m+1月的天数   
        function solarDays(y, m) {
            if (m == 1)
                return (((y % 4 == 0) &amp;&amp; (y % 100 != 0) || (y % 400 == 0)) ? 29
                        : 28);
            else
                return (solarMonth[m]);
        }
        //==============================   传入   offset   传回干支,   0=甲子   
        function cyclical(num) {
            return (Gan[num % 10] + Zhi[num % 12])
        }

        //======================   中文日期   
        function cDay(d) {
            var s;

            switch (d) {
            case 10:
                s = &apos;初十&apos;;
                break;
            case 20:
                s = &apos;二十&apos;;
                break;
            break;
        case 30:
            s = &apos;三十&apos;;
            break;
        break;
    default:
        s = nStr2[Math.floor(d / 10)];
        s += nStr1[d % 10];
    }
    return (s);
}
//======================   中文月份   
function cMonth(m) {
    var s;

    switch (m) {
    case 1:
        s = &apos;正月&apos;;
        break;
    case 2:
        s = &apos;二月&apos;;
        break;
    case 3:
        s = &apos;三月&apos;;
        break;
    case 4:
        s = &apos;四月&apos;;
        break;
    case 5:
        s = &apos;五月&apos;;
        break;
    case 6:
        s = &apos;六月&apos;;
        break;
    case 7:
        s = &apos;七月&apos;;
        break;
    case 8:
        s = &apos;八月&apos;;
        break;
    case 9:
        s = &apos;九月&apos;;
        break;
    case 10:
        s = &apos;十月&apos;;
        break;
    case 11:
        s = &apos;十一月&apos;;
        break;
    case 12:
        s = &apos;十二月&apos;;
        break;
    default:
        break;
    }
    return (s);
}

return teworks;
})（jQuery）;
</code></pre>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-inform-email-info" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/05/24/inform-email-info/" class="article-date">
  	<time datetime="2015-05-24T15:37:09.000Z" itemprop="datePublished">2015-05-24</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/24/inform-email-info/">JavaMail发送邮件</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>用JavaMail 实现发送邮件功能，在发送邮件之前，需要设置一下邮件服务器，端口，邮箱号和密码。</p>
<pre><code>public class MailSenderInfo { 

// 发送邮件的服务器的IP和端口 
private String mailServerHost; 
private String mailServerPort = &quot;25&quot;; 

// 邮件发送者的地址 
private String fromAddress; 

// 邮件接收者的地址 
private String toAddress; 

// 登陆邮件发送服务器的用户名和密码 
private String userName; 
private String password; 

// 是否需要身份验证 
private boolean validate = false; 

// 邮件主题 
private String subject; 

// 邮件的文本内容 
private String content; 

// 邮件附件的文件了路径
private String[] attachFileNames; 

/** 
  * 获得邮件会话属性 
  */ 
public Properties getProperties(){ 
  Properties p = new Properties(); 
  p.put(&quot;mail.smtp.host&quot;, this.mailServerHost); 
  p.put(&quot;mail.smtp.port&quot;, this.mailServerPort); 
  p.put(&quot;mail.transport.protocol&quot;, &quot;smtp&quot;);                 //设置邮件的传输协议
  p.put(&quot;mail.smtp.auth&quot;, validate ? &quot;true&quot; : &quot;false&quot;); 
  return p; 
} 

// 省略getter 和 setter
}
</code></pre><p>指定以上信息后，就可以发送邮件了。</p>
<pre><code>public static boolean sendHtmlMail(MailSenderInfo mailInfo) throws MessagingException {

    // 判断是否需要身份认证
    MyAuthenticator authenticator = null;
    Properties pro = mailInfo.getProperties();

    // 如果需要身份认证，则创建一个密码验证器
    if (mailInfo.isValidate()) {
        authenticator = new MyAuthenticator(mailInfo.getUserName(),
                mailInfo.getPassword());
        System.out.println(&quot;用户名：&quot;+mailInfo.getUserName());
    }

    // 根据邮件会话属性和密码验证器构造一个发送邮件的session
    Session sendMailSession = Session
            .getDefaultInstance(pro, authenticator);

    // 根据session创建一个邮件消息
    Message mailMessage = new MimeMessage(sendMailSession);

    // 创建邮件发送者地址
    Address from = new InternetAddress(mailInfo.getFromAddress());

    // 设置邮件消息的发送者
    mailMessage.setFrom(from);

    System.out.println(&quot;from 地址: &quot; + mailInfo.getFromAddress() + &quot;,&quot;
            + &quot;to 地址：&quot; + mailInfo.getToAddress());

    // 创建邮件的接收者地址，并设置到邮件消息中
    Address to = new InternetAddress(mailInfo.getToAddress());

    // Message.RecipientType.TO属性表示接收者的类型为TO
    mailMessage.setRecipient(Message.RecipientType.TO, to);

    // 设置邮件消息的主题
    mailMessage.setSubject(mailInfo.getSubject());

    // 设置邮件消息发送的时间
    mailMessage.setSentDate(new Date());

    // MiniMultipart类是一个容器类，包含MimeBodyPart类型的对象
    Multipart mainPart = new MimeMultipart();

    // 创建一个包含HTML内容的MimeBodyPart
    BodyPart html = new MimeBodyPart();

    // 设置HTML内容
    html.setContent(mailInfo.getContent(), &quot;text/html; charset=utf-8&quot;);

    mainPart.addBodyPart(html);

    // 附件文件
    String[] filePaths = mailInfo.getAttachFileNames();
    if (filePaths != null) {
        for (String filePath : filePaths) {
            MimeBodyPart mbp = new MimeBodyPart();
            FileDataSource fds = new FileDataSource(filePath); // 得到数据源
            mbp.setDataHandler(new DataHandler(fds)); // 得到附件本身并至入BodyPart
            mbp.setFileName(fds.getName()); // 得到文件名同样至入BodyPart
            mainPart.addBodyPart(mbp);
        }
    }

    // 将MiniMultipart对象设置为邮件内容
    mailMessage.setContent(mainPart);

    // 发送邮件
    // Transport.send(mailMessage);

    Transport transport = sendMailSession.getTransport();
    // 连接邮件smtp服务器，参数分别为服务器地址，用户名和密码
    transport.connect(mailInfo.getMailServerHost(), mailInfo.getUserName(),
            mailInfo.getPassword());
    transport.sendMessage(mailMessage, mailMessage.getAllRecipients());

    // 关闭连接
    transport.close();

    return true;


}
</code></pre><p>如果邮箱服务器，端口和密码出错，将会导致用户认证失败，将抛出异常：javax.mail.AuthenticationFailedException，请检查服务器，端口和邮箱密码等。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mail/">mail</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-backbone-coding-info" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/05/24/backbone-coding-info/" class="article-date">
  	<time datetime="2015-05-24T13:36:51.000Z" itemprop="datePublished">2015-05-24</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/24/backbone-coding-info/">Backbone前端开发流程及规范</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>开发流程<br>-</li>
</ul>
<h3 id="定好View"><a href="#定好View" class="headerlink" title="定好View"></a>定好View</h3><p>首先，根据页面切分View，切分View的规则是将重复利用的视图或者功能相近的视图归于一个View,对于Backbone，每一个model都要对应一个View。父层View负责布局，并将model发给子层View，让子层view负责渲染model数据。View并不是越多越好，要合理设计，View过多将会导致View资源管理成为负担；另外，View过于精简，可能会造成View的不必要的渲染工作。页面切分很有讲究，所以这一部分工作建议进行统一设计。</p>
<p>以下图作为例子进行View设计：<br><img src="http://i1.piimg.com/03aee69fe0cbc67c.png" alt=""></p>
<p>View设计如下：<br><img src="http://i1.piimg.com/3e05448400743d86.png" alt=""></p>
<p>这里一共有7个View(实际还有几个潜在view，比如弹窗，上传图片页面等，原理是一样的)：</p>
<p>MyMainView负责全局布局，并将子View的渲染内容填充到页面中；</p>
<p>TopView负责渲染页面头，包括网站图标，工具栏，关于我们等；</p>
<p>ContentView负责渲染页面主要内容；</p>
<p>FooterView负责渲染页面底部信息，包括&copy;copyright等；</p>
<p>ContentView 里面还可以继续划分:</p>
<p>ContentTopView负责内容管理工具条，包括相册的选择，管理相册按钮；</p>
<p>ContentListView负责贴图的主要页面部分，里面是一个个的ContentListItemView , ContentListView负责为每一个ContentListItemView的位置进行布局，每一个ContentListItemView只负责将本view的内容进行渲染；</p>
<p>结构如下：</p>
<p>-MyMainView</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;-TopView</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;-ContentView</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -ContentTopView</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -ContentListView</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-ContentListItemView</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;-FooterView</p>
<p>为了简要说明， 以下没说明样式，请自行加入。</p>
<p>MyMainView.js:</p>
<pre><code>define([&quot;backbone&quot;,&quot;TopView&quot; ,&quot;ContentView&quot;,&quot;FooterView] ,
    function(Backbone , TopView , ContentView , FooterView){

    var myMainView = Backbone.View.extend({
        initialize :{
            this.childrenView = [];
        },
        render:{
            this.$el.html(&quot;&lt;div id=&apos;topview&apos;&gt;&lt;/div&gt;&quot;);
            this.$el.append(&quot;&lt;div id=&apos;contentview&apos;&gt;&lt;/div&gt;&quot;);
            this.$el.append(&quot;&lt;div id=&apos;footerview&apos;&gt;&lt;/div&gt;&quot;);

            var topView = new TopView({el:&quot;#topview&quot;});
            this.childrenView.push(topview);
            topview.render();

            var contentView = new ContentView({el:&quot;#contentview&quot;});
            this.childrenView.push(contentView);
            contentView.render();

            var footerView = new FooterView({el:&quot;#footerview&quot;});
            this.childrenView.push(footerView);
            footerView.render();


        }    ,


    dispose : function(onlyDisposeChildren) {
        // 1
        if (!this.childrenViews
                || this.childrenViews.length == 0) {
            if (!onlyDisposeChildren) {
                this.remove();
            }
            return;
        }
        // 2
        _.each(this.childrenViews, function(childView) {
            if (childView.dispose) {
                childView.dispose();
            } else {
                childView.remove();
            }
        });
        // 3
        this.childrenViews = [];
        // 4
        if (!onlyDisposeChildren) {
            this.remove();
        }
    }
    });

    return myMainView;
});
</code></pre><p>利用Backbone划分View的好处就是，上层View只负责子层view的布局，而不需要关心子view的内容，具体的渲染工作交给子view去做，这样一个页面就可以划分为一个个的view,每一层view只关心本view的渲染和负责子view的布局。这样整个的页面开发更加有层次，并且打破常规的前端网页的开发模式，对于一个页面，可以多人进行开发，大大加快了效率。</p>
<h3 id="定义好每一个View所需的参数"><a href="#定义好每一个View所需的参数" class="headerlink" title="定义好每一个View所需的参数"></a>定义好每一个View所需的参数</h3><p>上面说到父view负责子view的布局，并且负责生成子view，所以子view需要的参数，也是由父view传给它；比如对于ContentListView：</p>
<pre><code>var contentListView = Backbone.View.extend({
initialize :function(data){
    this.collection = data.collection;
    this.COUNTPERROW = 5;
},

render :function(){

var self =this;
this.collection.each(function(aModel,index){

    var row = null;

    // 每行设计5张图片
    if (index % self.COUNTPERROW == 0) {

        row = $(&quot;&lt;div class=&apos;row&apos;&gt;&lt;/div&gt;&quot;);
        self .append(row);
    }

    // 父view负责布局
    var itemDiv= $(&quot;&lt;div id=&apos;&quot; + aModel.get(&quot;id)&apos; + &quot;&gt;&lt;/div&gt;);
    row.append(itemDiv);

    // 子view负责渲染
    var itemView = new ContentListItemView({
        el : itemDiv,
        model :aModel
    });
    self.childrenView.push(itemView);
    itemView.render();

});

},
});
</code></pre><h3 id="View之间独立开发"><a href="#View之间独立开发" class="headerlink" title="View之间独立开发"></a>View之间独立开发</h3><p>把整个页面的View划分好，并且将每一个的View的参数定义好后，就可以分配工作了，一个人负责几个View进行独立开发。</p>
<p>每一个View 要做的就三件事：</p>
<p>1、从上层取得渲染归属的dom节点 (this.$el) , 和所需参数； </p>
<p>2、本层负责在该dom节点中进行渲染；</p>
<p>3、为下层view布局，并传递数据</p>
<p>-前端开发注意事项<br>-</p>
<h2 id="dom结构"><a href="#dom结构" class="headerlink" title="dom结构"></a>dom结构</h2><p>网页是由一个个的Dom节点组成的，对于动态网页，需要动态对dom进行操作，在操作的过程尤其需要注意的是，在dom结构append到当前页面dom结构之前，该dom节点很有可能获取不到：</p>
<pre><code>var div = $(&quot;&lt;div id=&apos;test&apos;&gt;&lt;/div&gt;&quot;);
$(&quot;#test&quot;).html(&quot;ad&quot;);

this.$el.append(div);
</code></pre><p>在append到dom结构之前，就使用了id或class去查找dom接口，结果是没用的。<br>以上的方法可改为</p>
<pre><code>var div = $(&quot;&lt;div id=&apos;test&apos;&gt;&lt;/div&gt;&quot;);
$(div).html(&quot;ad&quot;);

this.$el.append(div);
</code></pre><p>jquery提供给了很多的方法：</p>
<h3 id="节点的操作"><a href="#节点的操作" class="headerlink" title="节点的操作"></a>节点的操作</h3><p><strong>查找节点</strong>：</p>
<pre><code>var $var_1=$(&quot;htmltype&quot;);   //这句话就是获取所有htmltype节点
</code></pre><p>如：var $ul_1=$(“ul”);</p>
<p><strong>创建并追加节点</strong>：</p>
<pre><code>var $var_1=$(&quot;&lt;htmltype&gt;&quot;);//这句话是创建一个节点

$(&quot;htmltype2&quot;).append($var_1) ; //这句话是把节点插入所有htmltype2节点中
</code></pre><p>例子：    </p>
<pre><code>var $li_1=$(&quot;&lt;li  title=&quot;title1&quot;&gt;香蕉&lt;/li&gt;&quot;);

     $(&quot;ul&quot;).append($li_1);
</code></pre><p>其中插入方法有以下几种：</p>
<pre><code>append() 把B追加到A内部（所有的A元素，以下类似）
appendTo() 把A追加到B内部
prepend() 把B追加到A内部的内容前
prependTo() 把A追加到B的内容前
after() 在A后追加B
insertAfter() 在A前追加B
before() 在A前追加B
insertBefore()在A后追加B 
</code></pre><p>例子：</p>
<pre><code>$(&quot;ul&quot;).append(&quot;&lt;li&gt;你好&lt;/li&gt;&quot;);//在ul内部追加li
 $(&quot;&lt;li&gt;你好&lt;/li&gt;&quot;).appendTo(&quot;ul&quot;);//在ul内部追加li
</code></pre><p><strong>删除节点</strong></p>
<pre><code>remove() 删除该元素
empty() 清空节点，包括后代节点 
</code></pre><p>例子：</p>
<pre><code>$(&quot;ul  li:eq[1]&quot;).remove(); //获取ul中的第二个li并删除
$(&quot;ul  li&quot;).remove(“li[title=&quot;菠萝&quot;]”);//删除ul中li元素属性title=&quot;菠萝&quot;的元素
</code></pre><p><strong>复制节点</strong></p>
<pre><code>clone();//复制本节点 
</code></pre><p>例子：</p>
<pre><code>$(&quot;ul  li:eq[1]&quot;).clone().appenTo(&quot;ul&quot;);//复制并追加到ul中，只复制是不会显示出来的
</code></pre><p><strong>替换节点</strong></p>
<pre><code>replaceWith();//将B替换所有A
replaceAll();//将A替换所有B 
</code></pre><p><strong>包裹节点</strong></p>
<pre><code>warpAll();//用B包裹A
warpInner();//用B包裹A的内容 
</code></pre><h3 id="属性操作"><a href="#属性操作" class="headerlink" title="属性操作"></a>属性操作</h3><p><strong>获取和设置属性</strong></p>
<pre><code>var $var_1=$(&quot;p&quot;);//这句话是获取节点P
var $p_1=$var_1.attr(&quot;title&quot;);//获取节点P的title属性
var $p_2=$var_1.attr(&quot;title&quot;,&quot;你好&quot;);//设置节点P的title属性为&quot;你好&quot;
</code></pre><p><strong>删除属性</strong></p>
<pre><code>$(&quot;p&quot;).removeAttr(&quot;title&quot;);//删除节点P的Title属性
</code></pre><h3 id="样式操作"><a href="#样式操作" class="headerlink" title="样式操作"></a>样式操作</h3><p><strong>获取和设置样式</strong></p>
<pre><code>var $var_class=$(&quot;p&quot;).attr(&quot;class&quot;);//获取节点P的class属性
$(&quot;p&quot;).attr(&quot;class&quot;,&quot;class1&quot;);设置节点P的class属性为样式表类class1
</code></pre><p><strong>追加样式</strong></p>
<pre><code>addClass() 添加样式到A 
</code></pre><p>例子：</p>
<pre><code>$(&quot;p&quot;).addClass(&quot;another&quot;);添加样式表类another类到P
</code></pre><p><strong>移除样式</strong></p>
<pre><code>removeClass() 移除类 
</code></pre><p><strong>切换样式</strong></p>
<pre><code>toggleClass() 切换clss属性类为新的类 
</code></pre><p><strong>判断某个样式是否存在</strong></p>
<pre><code>hasClass() 
</code></pre><h3 id="内容的操作"><a href="#内容的操作" class="headerlink" title="内容的操作"></a>内容的操作</h3><pre><code>html() 该方法获取html元素的内容，如：var var1=$(&quot;p&quot;).html();//获取P元素内的内容
text() 获取或设置某个html元素的内容
val() 获取元素的Value值
children() 获取html元素的所有子节点
next()  获取html元素后紧邻的同辈节点
prev() 获取html元素前紧邻的同辈节点
siblings() 获取html元素前后紧邻的同辈节点 ﻿ 
</code></pre><h3 id="CSS-DOM技术"><a href="#CSS-DOM技术" class="headerlink" title="CSS-DOM技术"></a>CSS-DOM技术</h3><pre><code>css(&quot;属性&quot;，&quot;值&quot;) 设置元素css某个属性的值，如：$(&quot;p&quot;).css(&quot;color&quot;,&quot;red&quot;);//设置P的css属性{color:red;}
</code></pre><h2 id="View手动销毁"><a href="#View手动销毁" class="headerlink" title="View手动销毁"></a>View手动销毁</h2><p>由于Backbone 没有提供view的销毁机制， 所以在不使用的时候要手动将view清理掉，否则view始终存在于内存中，更糟糕的是这个view所有的绑定和监听事件都是有效的；如果没有手动清理view的习惯，那么一个请求很有可能就会被多次发送，而你却始终找不到问题的所在，这样不仅浪费网页内存，让你的网页由于存在大量view而奇卡无比 ， 而且还会造成网络资源的浪费，服务器压力的倍增。<br>销毁函数可采用以下：</p>
<pre><code>dispose : function(onlyDisposeChildren) {
       // 1
       if (!this.childrenViews
               || this.childrenViews.length == 0) {
           if (!onlyDisposeChildren) {
               this.remove();
           }
           return;
       }
       // 2
       _.each(this.childrenViews, function(childView) {
           if (childView.dispose) {
               childView.dispose();
           } else {
               childView.remove();
           }
       });
       // 3
       this.childrenViews = [];
       // 4
       if (!onlyDisposeChildren) {
           this.remove();
       }
   }
</code></pre><h2 id="谨慎使用全局事件"><a href="#谨慎使用全局事件" class="headerlink" title="谨慎使用全局事件"></a>谨慎使用全局事件</h2><p>在某些情况下，为了使得事件能够在全局范围内传播，可以将事件绑定在全局变量Backbone中。</p>
<pre><code>this.listenTo(Backbone , &quot;Event:Test&quot; , this.HandleTest);
</code></pre><p>使用全局的确使得我们在事件触发和监听上获得了方便，但是需要特别谨慎的是，事件在view销毁之前会一直存在，如果该view没有调用remove方法，那么这个view和这个绑定事件就会一直存在的，由于是全局的事件，所以隐患很大。在切分View的时候，可能会分出几级的View视图出来，每一层View都可能会有事件监听，所以上一点说到的View销毁至关重要。另外在监听事件之前，最好先将当前事件进行解绑，让原有监听该事件的所有方法都失效，这样控制全局事件更加有效。</p>
<pre><code>Backbone.off(&quot;Event:Test&quot;);
</code></pre><h2 id="谨防js命名空间和css样式冲突"><a href="#谨防js命名空间和css样式冲突" class="headerlink" title="谨防js命名空间和css样式冲突"></a>谨防js命名空间和css样式冲突</h2><p>对于js命名空间冲突问题 ， 之前说过可以使用requireJS来解决命名空间冲突问题，对于requireJs的使用可以参考我之前的文章:<a href="http://vence.gitcafe.io/blog/2015/05/14/require-info/" target="_blank" rel="external">使用RequireJS实现异步加载脚本</a>。</p>
<p>至于样式冲突问题，目前还没有很好地方式可以避免，我们在开发的过程中，每个人负责一部分模块，在开发的过程中，会共用到很多样式文件，尤其对于SIP开发，所以在样式问题上冲突时常发生，这个需要开发人员商定好统一的格式进行定义， 比如可以在模块的样式前加上模块名进行限定。比如对于bootstrap的 col-md-x样式 , 可能有些开发人员需要的栅栏布局的样式需要调整，就自己在css中添加了样式：</p>
<pre><code>.col-md-12 {
    margin : 0px 0px;
}
</code></pre><p>这样的整个系统中所有的col-md-12样式都会照着这个样式进行，而其他的需要的就是bootstrap 默然的样式，这样的错误非常容易出现，所在大家养成模块限定的好习惯：</p>
<pre><code>#schedules .col-md-12 {
    margin : 0px 0px;
}
</code></pre><p>以上的样式只覆盖了 schedules 下的所有col-md-12的样式，这样可以有效解决样式冲突问题，前提是需要每个开发人员进行有效预防。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/backbone/">backbone</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 王文路
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>